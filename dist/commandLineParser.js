"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Command line parser for CLI
 */
class CommandLineParser {
    parse(argv) {
        const badParams = [];
        if (argv) {
            if (argv.length > 0) {
                this._interpreter = argv[0];
            }
            if (argv.length > 1) {
                this._script = argv[1];
            }
            let argStart = 2;
            if (argv.length > 2) {
                if (!argv[2].startsWith("--")) {
                    this._command = argv[2];
                    argStart++;
                }
            }
            if (argv.length > argStart) {
                for (let i = argStart; i < argv.length; i++) {
                    let arg = argv[i];
                    if (arg.startsWith("--")) {
                        this._arguments = this._arguments || {};
                        arg = arg.substring(2);
                        const eqIndex = arg.indexOf("=");
                        if (eqIndex === -1) {
                            this._arguments[arg] = null;
                        }
                        else {
                            this._arguments[arg.substring(0, eqIndex)] = arg.substring(eqIndex + 1);
                        }
                    }
                    else {
                        badParams.push(arg);
                    }
                }
            }
        }
        return badParams;
    }
    getInterpreter() {
        return this._interpreter;
    }
    getScript() {
        return this._script;
    }
    getCommand() {
        return this._command;
    }
    getStringArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            delete this._arguments[argumentName];
            if (arg === null) {
                return arg;
            }
            else {
                return this.trimQuotes(arg);
            }
        }
        else {
            return undefined;
        }
    }
    getNumberArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            // Regex from here https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseFloat
            if (/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(arg)) {
                delete this._arguments[argumentName];
                return parseFloat(arg);
            }
            else {
                return undefined;
            }
        }
        else {
            return undefined;
        }
    }
    getBooleanArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            if (arg !== null && arg !== undefined && arg.length > 0) {
                if (arg === "true") {
                    delete this._arguments[argumentName];
                    return true;
                }
                else if (arg === "false") {
                    delete this._arguments[argumentName];
                    return false;
                }
                else {
                    return undefined;
                }
            }
            else {
                delete this._arguments[argumentName];
                return true;
            }
        }
        else {
            return undefined;
        }
    }
    getStringArrayArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            if (arg !== null && arg !== undefined && arg.length > 0) {
                delete this._arguments[argumentName];
                const arr = arg.split(",");
                for (let i = 0; i < arr.length; i++) {
                    arr[i] = this.trimQuotes(arr[i]);
                }
                return arr;
            }
            else {
                delete this._arguments[argumentName];
                return [];
            }
        }
        else {
            return undefined;
        }
    }
    getRemaining() {
        const remaining = [];
        if (this._arguments) {
            const keys = Object.keys(this._arguments);
            keys.forEach(key => {
                remaining.push(`--${key}=${this._arguments[key]}`);
            });
        }
        return remaining;
    }
    hasArgument(argumentName) {
        return this._arguments !== undefined && (argumentName in this._arguments);
    }
    trimQuotes(input) {
        const arg = input.trim();
        if (arg.length >= 2 && arg.startsWith("\"") && arg.endsWith("\"")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else if (arg.length >= 2 && arg.startsWith("'") && arg.endsWith("'")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else if (arg.length >= 2 && arg.startsWith("`") && arg.endsWith("`")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else {
            return arg;
        }
    }
}
exports.CommandLineParser = CommandLineParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kTGluZVBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOztHQUVHO0FBQ0g7SUFNVyxLQUFLLENBQUMsSUFBYztRQUN2QixNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7UUFDL0IsSUFBSSxJQUFJLEVBQUU7WUFDTixJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNqQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMvQjtZQUNELElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzFCO1lBQ0QsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUMzQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDeEIsUUFBUSxFQUFFLENBQUM7aUJBQ2Q7YUFDSjtZQUNELElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLEVBQUU7Z0JBQ3hCLEtBQUssSUFBSSxDQUFDLEdBQUcsUUFBUSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUN6QyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2xCLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRTt3QkFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQzt3QkFDeEMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMs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T0FBTyxHQUFHLENBQUM7U0FDZDtJQUNMLENBQUM7Q0FDSjtBQWpLRCw4Q0FpS0MiLCJmaWxlIjoiY29tbWFuZExpbmVQYXJzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbW1hbmQgbGluZSBwYXJzZXIgZm9yIENMSVxuICovXG5leHBvcnQgY2xhc3MgQ29tbWFuZExpbmVQYXJzZXIge1xuICAgIHByaXZhdGUgX2ludGVycHJldGVyOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfc2NyaXB0OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfY29tbWFuZDogc3RyaW5nO1xuICAgIHByaXZhdGUgX2FyZ3VtZW50czogeyBbaWQ6IHN0cmluZ106IHN0cmluZyB8IG51bGwgfTtcblxuICAgIHB1YmxpYyBwYXJzZShhcmd2OiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgYmFkUGFyYW1zOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBpZiAoYXJndikge1xuICAgICAgICAgICAgaWYgKGFyZ3YubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ludGVycHJldGVyID0gYXJndlswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcmd2Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHQgPSBhcmd2WzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGFyZ1N0YXJ0ID0gMjtcbiAgICAgICAgICAgIGlmIChhcmd2Lmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFyZ3ZbMl0uc3RhcnRzV2l0aChcIi0tXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbW1hbmQgPSBhcmd2WzJdO1xuICAgICAgICAgICAgICAgICAgICBhcmdTdGFydCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcmd2Lmxlbmd0aCA+IGFyZ1N0YXJ0KSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFyZ1N0YXJ0OyBpIDwgYXJndi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgYXJnID0gYXJndltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZy5zdGFydHNXaXRoKFwiLS1cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FyZ3VtZW50cyA9IHRoaXMuX2FyZ3VtZW50cyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IGFyZy5zdWJzdHJpbmcoMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlcUluZGV4OiBudW1iZXIgPSBhcmcuaW5kZXhPZihcIj1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXFJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcmd1bWVudHNbYXJnXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FyZ3VtZW50c1thcmcuc3Vic3RyaW5nKDAsIGVxSW5kZXgpXSA9IGFyZy5zdWJzdHJpbmcoZXFJbmRleCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFkUGFyYW1zLnB1c2goYXJnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFkUGFyYW1zO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJbnRlcnByZXRlcigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJwcmV0ZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFNjcmlwdCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2NyaXB0O1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDb21tYW5kKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb21tYW5kO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRTdHJpbmdBcmd1bWVudDxUIGV4dGVuZHMgc3RyaW5nPihhcmd1bWVudE5hbWU6IHN0cmluZyk6IFQgfCB1bmRlZmluZWQgfCBudWxsIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXJndW1lbnQoYXJndW1lbnROYW1lKSkge1xuICAgICAgICAgICAgY29uc3QgYXJnID0gdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG5cbiAgICAgICAgICAgIGlmIChhcmcgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPFQ+YXJnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPFQ+dGhpcy50cmltUXVvdGVzKGFyZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldE51bWJlckFyZ3VtZW50KGFyZ3VtZW50TmFtZTogc3RyaW5nKTogbnVtYmVyIHwgdW5kZWZpbmVkIHwgbnVsbCB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FyZ3VtZW50KGFyZ3VtZW50TmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuXG4gICAgICAgICAgICAvLyBSZWdleCBmcm9tIGhlcmUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvcGFyc2VGbG9hdFxuICAgICAgICAgICAgaWYgKC9eKFxcLXxcXCspPyhbMC05XSsoXFwuWzAtOV0rKT8pJC8udGVzdChhcmcpKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGFyZyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEJvb2xlYW5Bcmd1bWVudChhcmd1bWVudE5hbWU6IHN0cmluZyk6IGJvb2xlYW4gfCB1bmRlZmluZWQgfCBudWxsIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXJndW1lbnQoYXJndW1lbnROYW1lKSkge1xuICAgICAgICAgICAgY29uc3QgYXJnID0gdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG5cbiAgICAgICAgICAgIGlmIChhcmcgIT09IG51bGwgJiYgYXJnICE9PSB1bmRlZmluZWQgJiYgYXJnLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJnID09PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXJnID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U3RyaW5nQXJyYXlBcmd1bWVudChhcmd1bWVudE5hbWU6IHN0cmluZyk6IHN0cmluZ1tdIHwgdW5kZWZpbmVkIHwgbnVsbCB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FyZ3VtZW50KGFyZ3VtZW50TmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuXG4gICAgICAgICAgICBpZiAoYXJnICE9PSBudWxsICYmIGFyZyAhPT0gdW5kZWZpbmVkICYmIGFyZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IGFyZy5zcGxpdChcIixcIik7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBhcnJbaV0gPSB0aGlzLnRyaW1RdW90ZXMoYXJyW2ldKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRSZW1haW5pbmcoKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCByZW1haW5pbmc6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMuX2FyZ3VtZW50cykge1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX2FyZ3VtZW50cyk7XG4gICAgICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICByZW1haW5pbmcucHVzaChgLS0ke2tleX09JHt0aGlzLl9hcmd1bWVudHNba2V5XX1gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlbWFpbmluZztcbiAgICB9XG5cbiAgICBwdWJsaWMgaGFzQXJndW1lbnQoYXJndW1lbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FyZ3VtZW50cyAhPT0gdW5kZWZpbmVkICYmIChhcmd1bWVudE5hbWUgaW4gdGhpcy5fYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyaW1RdW90ZXMoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGFyZyA9IGlucHV0LnRyaW0oKTtcblxuICAgICAgICBpZiAoYXJnLmxlbmd0aCA+PSAyICYmIGFyZy5zdGFydHNXaXRoKFwiXFxcIlwiKSAmJiBhcmcuZW5kc1dpdGgoXCJcXFwiXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJnLnN1YnN0cmluZygxLCBhcmcubGVuZ3RoIC0gMSkudHJpbSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGFyZy5sZW5ndGggPj0gMiAmJiBhcmcuc3RhcnRzV2l0aChcIidcIikgJiYgYXJnLmVuZHNXaXRoKFwiJ1wiKSkge1xuICAgICAgICAgICAgcmV0dXJuIGFyZy5zdWJzdHJpbmcoMSwgYXJnLmxlbmd0aCAtIDEpLnRyaW0oKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmcubGVuZ3RoID49IDIgJiYgYXJnLnN0YXJ0c1dpdGgoXCJgXCIpICYmIGFyZy5lbmRzV2l0aChcImBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBhcmcuc3Vic3RyaW5nKDEsIGFyZy5sZW5ndGggLSAxKS50cmltKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYXJnO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19
