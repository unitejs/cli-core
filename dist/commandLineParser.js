"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Command line parser for CLI
 */
class CommandLineParser {
    parse(argv) {
        const badParams = [];
        if (argv) {
            if (argv.length > 0) {
                this._interpreter = argv[0];
            }
            if (argv.length > 1) {
                this._script = argv[1];
            }
            let argStart = 2;
            if (argv.length > 2) {
                if (!argv[2].startsWith("--")) {
                    this._command = argv[2];
                    argStart++;
                }
            }
            if (argv.length > argStart) {
                for (let i = argStart; i < argv.length; i++) {
                    let arg = argv[i];
                    if (arg.startsWith("--")) {
                        this._arguments = this._arguments || {};
                        arg = arg.substring(2);
                        const eqIndex = arg.indexOf("=");
                        if (eqIndex === -1) {
                            this._arguments[arg] = null;
                        }
                        else {
                            this._arguments[arg.substring(0, eqIndex)] = arg.substring(eqIndex + 1);
                        }
                    }
                    else {
                        badParams.push(arg);
                    }
                }
            }
        }
        return badParams;
    }
    getInterpreter() {
        return this._interpreter;
    }
    getScript() {
        return this._script;
    }
    getCommand() {
        return this._command;
    }
    getStringArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            delete this._arguments[argumentName];
            if (arg === null) {
                return arg;
            }
            else {
                return this.trimQuotes(arg);
            }
        }
        else {
            return undefined;
        }
    }
    getNumberArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            // Regex from here https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseFloat
            if (/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(arg)) {
                delete this._arguments[argumentName];
                return parseFloat(arg);
            }
            else {
                return undefined;
            }
        }
        else {
            return undefined;
        }
    }
    getBooleanArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            if (arg !== null && arg !== undefined && arg.length > 0) {
                if (arg === "true") {
                    delete this._arguments[argumentName];
                    return true;
                }
                else if (arg === "false") {
                    delete this._arguments[argumentName];
                    return false;
                }
                else {
                    return undefined;
                }
            }
            else {
                delete this._arguments[argumentName];
                return true;
            }
        }
        else {
            return undefined;
        }
    }
    getStringArrayArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            if (arg !== null && arg !== undefined && arg.length > 0) {
                delete this._arguments[argumentName];
                const arr = arg.split(",");
                for (let i = 0; i < arr.length; i++) {
                    arr[i] = this.trimQuotes(arr[i]);
                }
                return arr;
            }
            else {
                delete this._arguments[argumentName];
                return [];
            }
        }
        else {
            return undefined;
        }
    }
    getRemaining() {
        const remaining = [];
        if (this._arguments) {
            const keys = Object.keys(this._arguments);
            keys.forEach(key => {
                remaining.push(`--${key}=${this._arguments[key]}`);
            });
        }
        return remaining;
    }
    hasArgument(argumentName) {
        return this._arguments !== undefined && (argumentName in this._arguments);
    }
    trimQuotes(input) {
        const arg = input.trim();
        if (arg.length >= 2 && arg.startsWith("\"") && arg.endsWith("\"")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else if (arg.length >= 2 && arg.startsWith("'") && arg.endsWith("'")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else if (arg.length >= 2 && arg.startsWith("`") && arg.endsWith("`")) {
            return arg.substring(1, arg.length - 1).trim();
        }
        else {
            return arg;
        }
    }
}
exports.CommandLineParser = CommandLineParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kTGluZVBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOztHQUVHO0FBQ0gsTUFBYSxpQkFBaUI7SUFNbkIsS0FBSyxDQUFDLElBQWM7UUFDdkIsTUFBTSxTQUFTLEdBQWEsRUFBRSxDQUFDO1FBQy9CLElBQUksSUFBSSxFQUFFO1lBQ04sSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDL0I7WUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxQjtZQUNELElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztZQUNqQixJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDM0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3hCLFFBQVEsRUFBRSxDQUFDO2lCQUNkO2FBQ0o7WUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxFQUFFO2dCQUN4QixLQUFLLElBQUksQ0FBQyxHQUFHLFFBQVEsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtvQkFDekMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNsQixJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7d0JBQ3RCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUM7d0JBQ3hDLEdBQUcsR0FBRyxHQUFHLENB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bEQ7YUFBTTtZQUNILE9BQU8sR0FBRyxDQUFDO1NBQ2Q7SUFDTCxDQUFDO0NBQ0o7QUFqS0QsOENBaUtDIiwiZmlsZSI6ImNvbW1hbmRMaW5lUGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21tYW5kIGxpbmUgcGFyc2VyIGZvciBDTElcbiAqL1xuZXhwb3J0IGNsYXNzIENvbW1hbmRMaW5lUGFyc2VyIHtcbiAgICBwcml2YXRlIF9pbnRlcnByZXRlcjogc3RyaW5nO1xuICAgIHByaXZhdGUgX3NjcmlwdDogc3RyaW5nO1xuICAgIHByaXZhdGUgX2NvbW1hbmQ6IHN0cmluZztcbiAgICBwcml2YXRlIF9hcmd1bWVudHM6IHsgW2lkOiBzdHJpbmddOiBzdHJpbmcgfCBudWxsIH07XG5cbiAgICBwdWJsaWMgcGFyc2UoYXJndjogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IGJhZFBhcmFtczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgaWYgKGFyZ3YpIHtcbiAgICAgICAgICAgIGlmIChhcmd2Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcnByZXRlciA9IGFyZ3ZbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXJndi5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0ID0gYXJndlsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBhcmdTdGFydCA9IDI7XG4gICAgICAgICAgICBpZiAoYXJndi5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFhcmd2WzJdLnN0YXJ0c1dpdGgoXCItLVwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21tYW5kID0gYXJndlsyXTtcbiAgICAgICAgICAgICAgICAgICAgYXJnU3RhcnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXJndi5sZW5ndGggPiBhcmdTdGFydCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBhcmdTdGFydDsgaSA8IGFyZ3YubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFyZyA9IGFyZ3ZbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmcuc3RhcnRzV2l0aChcIi0tXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcmd1bWVudHMgPSB0aGlzLl9hcmd1bWVudHMgfHwge307XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmcgPSBhcmcuc3Vic3RyaW5nKDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXFJbmRleDogbnVtYmVyID0gYXJnLmluZGV4T2YoXCI9XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVxSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJndW1lbnRzW2FyZ10gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcmd1bWVudHNbYXJnLnN1YnN0cmluZygwLCBlcUluZGV4KV0gPSBhcmcuc3Vic3RyaW5nKGVxSW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhZFBhcmFtcy5wdXNoKGFyZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhZFBhcmFtcztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SW50ZXJwcmV0ZXIoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ludGVycHJldGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRTY3JpcHQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q29tbWFuZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29tbWFuZDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U3RyaW5nQXJndW1lbnQ8VCBleHRlbmRzIHN0cmluZz4oYXJndW1lbnROYW1lOiBzdHJpbmcpOiBUIHwgdW5kZWZpbmVkIHwgbnVsbCB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FyZ3VtZW50KGFyZ3VtZW50TmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuXG4gICAgICAgICAgICBpZiAoYXJnID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxUPmFyZztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxUPnRoaXMudHJpbVF1b3RlcyhhcmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXROdW1iZXJBcmd1bWVudChhcmd1bWVudE5hbWU6IHN0cmluZyk6IG51bWJlciB8IHVuZGVmaW5lZCB8IG51bGwge1xuICAgICAgICBpZiAodGhpcy5oYXNBcmd1bWVudChhcmd1bWVudE5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBhcmcgPSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcblxuICAgICAgICAgICAgLy8gUmVnZXggZnJvbSBoZXJlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL3BhcnNlRmxvYXRcbiAgICAgICAgICAgIGlmICgvXihcXC18XFwrKT8oWzAtOV0rKFxcLlswLTldKyk/KSQvLnRlc3QoYXJnKSkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhcmcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRCb29sZWFuQXJndW1lbnQoYXJndW1lbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHwgdW5kZWZpbmVkIHwgbnVsbCB7XG4gICAgICAgIGlmICh0aGlzLmhhc0FyZ3VtZW50KGFyZ3VtZW50TmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGFyZyA9IHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuXG4gICAgICAgICAgICBpZiAoYXJnICE9PSBudWxsICYmIGFyZyAhPT0gdW5kZWZpbmVkICYmIGFyZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZyA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZyA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldFN0cmluZ0FycmF5QXJndW1lbnQoYXJndW1lbnROYW1lOiBzdHJpbmcpOiBzdHJpbmdbXSB8IHVuZGVmaW5lZCB8IG51bGwge1xuICAgICAgICBpZiAodGhpcy5oYXNBcmd1bWVudChhcmd1bWVudE5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBhcmcgPSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcblxuICAgICAgICAgICAgaWYgKGFyZyAhPT0gbnVsbCAmJiBhcmcgIT09IHVuZGVmaW5lZCAmJiBhcmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcnIgPSBhcmcuc3BsaXQoXCIsXCIpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyW2ldID0gdGhpcy50cmltUXVvdGVzKGFycltpXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UmVtYWluaW5nKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLl9hcmd1bWVudHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLl9hcmd1bWVudHMpO1xuICAgICAgICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgcmVtYWluaW5nLnB1c2goYC0tJHtrZXl9PSR7dGhpcy5fYXJndW1lbnRzW2tleV19YCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZW1haW5pbmc7XG4gICAgfVxuXG4gICAgcHVibGljIGhhc0FyZ3VtZW50KGFyZ3VtZW50TmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hcmd1bWVudHMgIT09IHVuZGVmaW5lZCAmJiAoYXJndW1lbnROYW1lIGluIHRoaXMuX2FyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmltUXVvdGVzKGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBhcmcgPSBpbnB1dC50cmltKCk7XG5cbiAgICAgICAgaWYgKGFyZy5sZW5ndGggPj0gMiAmJiBhcmcuc3RhcnRzV2l0aChcIlxcXCJcIikgJiYgYXJnLmVuZHNXaXRoKFwiXFxcIlwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIGFyZy5zdWJzdHJpbmcoMSwgYXJnLmxlbmd0aCAtIDEpLnRyaW0oKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmcubGVuZ3RoID49IDIgJiYgYXJnLnN0YXJ0c1dpdGgoXCInXCIpICYmIGFyZy5lbmRzV2l0aChcIidcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBhcmcuc3Vic3RyaW5nKDEsIGFyZy5sZW5ndGggLSAxKS50cmltKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXJnLmxlbmd0aCA+PSAyICYmIGFyZy5zdGFydHNXaXRoKFwiYFwiKSAmJiBhcmcuZW5kc1dpdGgoXCJgXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJnLnN1YnN0cmluZygxLCBhcmcubGVuZ3RoIC0gMSkudHJpbSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGFyZztcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
