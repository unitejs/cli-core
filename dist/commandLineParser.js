"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Command line parser for CLI
 */
class CommandLineParser {
    parse(argv) {
        const badParams = [];
        if (argv) {
            if (argv.length > 0) {
                this._interpreter = argv[0];
            }
            if (argv.length > 1) {
                this._script = argv[1];
            }
            let argStart = 2;
            if (argv.length > 2) {
                if (!argv[2].startsWith("--")) {
                    this._command = argv[2];
                    argStart++;
                }
            }
            if (argv.length > argStart) {
                for (let i = argStart; i < argv.length; i++) {
                    let arg = argv[i];
                    if (arg.startsWith("--")) {
                        this._arguments = this._arguments || {};
                        arg = arg.substring(2);
                        const eqIndex = arg.indexOf("=");
                        if (eqIndex === -1) {
                            this._arguments[arg] = null;
                        }
                        else {
                            this._arguments[arg.substring(0, eqIndex)] = arg.substring(eqIndex + 1);
                        }
                    }
                    else {
                        badParams.push(arg);
                    }
                }
            }
        }
        return badParams;
    }
    getInterpreter() {
        return this._interpreter;
    }
    getScript() {
        return this._script;
    }
    getCommand() {
        return this._command;
    }
    getStringArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            delete this._arguments[argumentName];
            if (arg === null) {
                return arg;
            }
            else {
                if (arg.length >= 2 && arg.startsWith("\"") && arg.endsWith("\"")) {
                    return arg.substring(1, arg.length - 1).trim();
                }
                else if (arg.length >= 2 && arg.startsWith("'") && arg.endsWith("'")) {
                    return arg.substring(1, arg.length - 1).trim();
                }
                else {
                    return arg.trim();
                }
            }
        }
        else {
            return undefined;
        }
    }
    getNumberArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            // Regex from here https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseFloat
            if (/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(arg)) {
                delete this._arguments[argumentName];
                return parseFloat(arg);
            }
            else {
                return undefined;
            }
        }
        else {
            return undefined;
        }
    }
    getBooleanArgument(argumentName) {
        if (this.hasArgument(argumentName)) {
            const arg = this._arguments[argumentName];
            if (arg !== null && arg !== undefined && arg.length > 0) {
                if (arg === "true") {
                    delete this._arguments[argumentName];
                    return true;
                }
                else if (arg === "false") {
                    delete this._arguments[argumentName];
                    return false;
                }
                else {
                    return undefined;
                }
            }
            else {
                delete this._arguments[argumentName];
                return true;
            }
        }
        else {
            return undefined;
        }
    }
    getRemaining() {
        const remaining = [];
        if (this._arguments) {
            const keys = Object.keys(this._arguments);
            keys.forEach(key => {
                remaining.push(`--${key}=${this._arguments[key]}`);
            });
        }
        return remaining;
    }
    hasArgument(argumentName) {
        return this._arguments !== undefined && (argumentName in this._arguments);
    }
}
exports.CommandLineParser = CommandLineParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kTGluZVBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOztHQUVHO0FBQ0g7SUFNVyxLQUFLLENBQUMsSUFBYztRQUN2QixNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7UUFDL0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNQLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0IsQ0FBQztZQUNELElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztZQUNqQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzVCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixRQUFRLEVBQUUsQ0FBQztnQkFDZixDQUFDO1lBQ0wsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDekIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsUUFBUSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQzFDLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxD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Q3pCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztvQkFDckMsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDakIsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDSixNQUFNLENBQUMsU0FBUyxDQUFDO2dCQUNyQixDQUFDO1lBQ0wsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDckMsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNoQixDQUFDO1FBQ0wsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUNyQixDQUFDO0lBQ0wsQ0FBQztJQUVNLFlBQVk7UUFDZixNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7UUFFL0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDbEIsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDMUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHO2dCQUNaLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDO1FBRUQsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNyQixDQUFDO0lBRU0sV0FBVyxDQUFDLFlBQW9CO1FBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxLQUFLLFNBQVMsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDOUUsQ0FBQztDQUNKO0FBbklELDhDQW1JQyIsImZpbGUiOiJjb21tYW5kTGluZVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29tbWFuZCBsaW5lIHBhcnNlciBmb3IgQ0xJXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21tYW5kTGluZVBhcnNlciB7XG4gICAgcHJpdmF0ZSBfaW50ZXJwcmV0ZXI6IHN0cmluZztcbiAgICBwcml2YXRlIF9zY3JpcHQ6IHN0cmluZztcbiAgICBwcml2YXRlIF9jb21tYW5kOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfYXJndW1lbnRzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIHwgbnVsbCB9O1xuXG4gICAgcHVibGljIHBhcnNlKGFyZ3Y6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCBiYWRQYXJhbXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGlmIChhcmd2KSB7XG4gICAgICAgICAgICBpZiAoYXJndi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW50ZXJwcmV0ZXIgPSBhcmd2WzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFyZ3YubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NjcmlwdCA9IGFyZ3ZbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYXJnU3RhcnQgPSAyO1xuICAgICAgICAgICAgaWYgKGFyZ3YubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgIGlmICghYXJndlsyXS5zdGFydHNXaXRoKFwiLS1cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29tbWFuZCA9IGFyZ3ZbMl07XG4gICAgICAgICAgICAgICAgICAgIGFyZ1N0YXJ0Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFyZ3YubGVuZ3RoID4gYXJnU3RhcnQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gYXJnU3RhcnQ7IGkgPCBhcmd2Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBhcmcgPSBhcmd2W2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJnLnN0YXJ0c1dpdGgoXCItLVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJndW1lbnRzID0gdGhpcy5fYXJndW1lbnRzIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJnID0gYXJnLnN1YnN0cmluZygyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVxSW5kZXg6IG51bWJlciA9IGFyZy5pbmRleE9mKFwiPVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcUluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FyZ3VtZW50c1thcmddID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJndW1lbnRzW2FyZy5zdWJzdHJpbmcoMCwgZXFJbmRleCldID0gYXJnLnN1YnN0cmluZyhlcUluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWRQYXJhbXMucHVzaChhcmcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBiYWRQYXJhbXM7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEludGVycHJldGVyKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnRlcnByZXRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2NyaXB0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY3JpcHQ7XG4gICAgfVxuXG4gICAgcHVibGljIGdldENvbW1hbmQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbW1hbmQ7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFN0cmluZ0FyZ3VtZW50PFQgZXh0ZW5kcyBzdHJpbmc+KGFyZ3VtZW50TmFtZTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCB8IG51bGwge1xuICAgICAgICBpZiAodGhpcy5oYXNBcmd1bWVudChhcmd1bWVudE5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBhcmcgPSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcblxuICAgICAgICAgICAgaWYgKGFyZyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8VD5hcmc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChhcmcubGVuZ3RoID49IDIgJiYgYXJnLnN0YXJ0c1dpdGgoXCJcXFwiXCIpICYmIGFyZy5lbmRzV2l0aChcIlxcXCJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxUPmFyZy5zdWJzdHJpbmcoMSwgYXJnLmxlbmd0aCAtIDEpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZy5sZW5ndGggPj0gMiAmJiBhcmcuc3RhcnRzV2l0aChcIidcIikgJiYgYXJnLmVuZHNXaXRoKFwiJ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPFQ+YXJnLnN1YnN0cmluZygxLCBhcmcubGVuZ3RoIC0gMSkudHJpbSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8VD5hcmcudHJpbSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TnVtYmVyQXJndW1lbnQoYXJndW1lbnROYW1lOiBzdHJpbmcpOiBudW1iZXIgfCB1bmRlZmluZWQgfCBudWxsIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXJndW1lbnQoYXJndW1lbnROYW1lKSkge1xuICAgICAgICAgICAgY29uc3QgYXJnID0gdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG5cbiAgICAgICAgICAgIC8vIFJlZ2V4IGZyb20gaGVyZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9wYXJzZUZsb2F0XG4gICAgICAgICAgICBpZiAoL14oXFwtfFxcKyk/KFswLTldKyhcXC5bMC05XSspPykkLy50ZXN0KGFyZykpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYXJnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Qm9vbGVhbkFyZ3VtZW50KGFyZ3VtZW50TmFtZTogc3RyaW5nKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB8IG51bGwge1xuICAgICAgICBpZiAodGhpcy5oYXNBcmd1bWVudChhcmd1bWVudE5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBhcmcgPSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcblxuICAgICAgICAgICAgaWYgKGFyZyAhPT0gbnVsbCAmJiBhcmcgIT09IHVuZGVmaW5lZCAmJiBhcmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChhcmcgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hcmd1bWVudHNbYXJndW1lbnROYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhcmcgPT09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXJndW1lbnRzW2FyZ3VtZW50TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2FyZ3VtZW50c1thcmd1bWVudE5hbWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRSZW1haW5pbmcoKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCByZW1haW5pbmc6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMuX2FyZ3VtZW50cykge1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX2FyZ3VtZW50cyk7XG4gICAgICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICByZW1haW5pbmcucHVzaChgLS0ke2tleX09JHt0aGlzLl9hcmd1bWVudHNba2V5XX1gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlbWFpbmluZztcbiAgICB9XG5cbiAgICBwdWJsaWMgaGFzQXJndW1lbnQoYXJndW1lbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FyZ3VtZW50cyAhPT0gdW5kZWZpbmVkICYmIChhcmd1bWVudE5hbWUgaW4gdGhpcy5fYXJndW1lbnRzKTtcbiAgICB9XG59XG4iXX0=
