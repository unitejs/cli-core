"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for WebSecureClient.
 */
const Chai = require("chai");
const https = require("https");
const Sinon = require("sinon");
const webSecureClient_1 = require("../../../dist/webSecureClient");
describe("WebSecureClient", () => {
    let sandbox;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
    }));
    it("can be created", () => {
        const obj = new webSecureClient_1.WebSecureClient();
        Chai.should().exist(obj);
    });
    describe("getText", () => {
        it("can be called url undefined", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new webSecureClient_1.WebSecureClient();
            try {
                yield obj.getText(undefined);
            }
            catch (err) {
                Chai.expect(err).to.contain("Invalid");
            }
        }));
        it("can be called and return an error", () => __awaiter(this, void 0, void 0, function* () {
            sandbox.stub(https, "get").throws(new Error("Invalid"));
            const obj = new webSecureClient_1.WebSecureClient();
            try {
                yield obj.getText("https://a.com");
            }
            catch (err) {
                Chai.expect(err.message).to.contain("Invalid");
            }
        }));
        it("can return an error", () => __awaiter(this, void 0, void 0, function* () {
            const requestMock = {
                on: (type, cb) => {
                    if (type === "error") {
                        cb(new Error("Invalid"));
                    }
                }
            };
            sandbox.stub(https, "get").returns(requestMock);
            const obj = new webSecureClient_1.WebSecureClient();
            try {
                yield obj.getText("https://a.com");
            }
            catch (err) {
                Chai.expect(err.message).to.contain("Invalid");
            }
        }));
        it("can timeout", () => __awaiter(this, void 0, void 0, function* () {
            const socketMock = {
                on: (type, cb) => {
                    if (type === "timeout") {
                        cb(new Error("Invalid"));
                    }
                },
                setTimeout: () => {
                }
            };
            const requestMock = {
                on: (type, cb) => {
                    if (type === "socket") {
                        cb(socketMock);
                    }
                },
                abort: () => {
                    throw new Error("Aborted");
                }
            };
            sandbox.stub(https, "get").returns(requestMock);
            const obj = new webSecureClient_1.WebSecureClient();
            try {
                yield obj.getText("https://a.com", 1);
            }
            catch (err) {
                Chai.expect(err.message).to.contain("Aborted");
            }
        }));
        it("can return data", () => __awaiter(this, void 0, void 0, function* () {
            const responseMock = {
                on: (type, cb) => {
                    if (type === "data") {
                        cb("hello");
                    }
                    else if (type === "end") {
                        cb("");
                    }
                }
            };
            const getStub = sandbox.stub(https, "get");
            getStub.callsFake((url, cb) => {
                cb(responseMock);
            });
            const obj = new webSecureClient_1.WebSecureClient();
            const data = yield obj.getText("https://a.com");
            Chai.expect(data).to.contain("hello");
        }));
    });
    describe("getJson", () => {
        it("can be called and get data", () => __awaiter(this, void 0, void 0, function* () {
            const responseMock = {
                on: (type, cb) => {
                    if (type === "data") {
                        cb(JSON.stringify({ a: "b", c: [1, 2, 3] }));
                    }
                    else if (type === "end") {
                        cb("");
                    }
                }
            };
            const getStub = sandbox.stub(https, "get");
            getStub.callsFake((url, cb) => {
                cb(responseMock);
            });
            const obj = new webSecureClient_1.WebSecureClient();
            const data = yield obj.getJson("https://a.com");
            Chai.expect(data).to.deep.equal({ a: "b", c: [1, 2, 3] });
        }));
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvd2ViU2VjdXJlQ2xpZW50LnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztHQUVHO0FBQ0gsNkJBQTZCO0FBQzdCLCtCQUErQjtBQUMvQiwrQkFBK0I7QUFDL0Isa0VBQStEO0FBRS9ELFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxPQUEyQixDQUFDO0lBRWhDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNyQyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFTLEVBQUU7UUFDakIsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3RCLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLE1BQU0sR0FBRyxHQUFHLElBQUksaUNBQWUsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtRQUNyQixFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBUyxFQUFFO1lBQ3pDLE1BQU0sR0FBRyxHQUFHLElBQUksaUNBQWUsRUFBRSxDQUFDO1lBQ2xDLElBQUk7Z0JBQ0EsTUFBTSxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ2hDO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQzFDO1FBQ0wsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxH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QUFFO3dCQUN2QixFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ1Y7Z0JBQ0wsQ0FBQzthQUNKLENBQUM7WUFDRixNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMzQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFO2dCQUMxQixFQUFFLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDckIsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLEdBQUcsR0FBRyxJQUFJLGlDQUFlLEVBQUUsQ0FBQztZQUNsQyxNQUFNLElBQUksR0FBRyxNQUFNLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoid2ViU2VjdXJlQ2xpZW50LnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBXZWJTZWN1cmVDbGllbnQuXG4gKi9cbmltcG9ydCAqIGFzIENoYWkgZnJvbSBcImNoYWlcIjtcbmltcG9ydCAqIGFzIGh0dHBzIGZyb20gXCJodHRwc1wiO1xuaW1wb3J0ICogYXMgU2lub24gZnJvbSBcInNpbm9uXCI7XG5pbXBvcnQgeyBXZWJTZWN1cmVDbGllbnQgfSBmcm9tIFwiLi4vLi4vLi4vc3JjL3dlYlNlY3VyZUNsaWVudFwiO1xuXG5kZXNjcmliZShcIldlYlNlY3VyZUNsaWVudFwiLCAoKSA9PiB7XG4gICAgbGV0IHNhbmRib3g6IFNpbm9uLlNpbm9uU2FuZGJveDtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBzYW5kYm94ID0gU2lub24uc2FuZGJveC5jcmVhdGUoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjYW4gYmUgY3JlYXRlZFwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IG5ldyBXZWJTZWN1cmVDbGllbnQoKTtcbiAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZXRUZXh0XCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHVybCB1bmRlZmluZWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IFdlYlNlY3VyZUNsaWVudCgpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBvYmouZ2V0VGV4dCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZXJyKS50by5jb250YWluKFwiSW52YWxpZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIGFuZCByZXR1cm4gYW4gZXJyb3JcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgc2FuZGJveC5zdHViKGh0dHBzLCBcImdldFwiKS50aHJvd3MobmV3IEVycm9yKFwiSW52YWxpZFwiKSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgV2ViU2VjdXJlQ2xpZW50KCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9iai5nZXRUZXh0KFwiaHR0cHM6Ly9hLmNvbVwiKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIENoYWkuZXhwZWN0KGVyci5tZXNzYWdlKS50by5jb250YWluKFwiSW52YWxpZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gcmV0dXJuIGFuIGVycm9yXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RNb2NrID0ge1xuICAgICAgICAgICAgICAgIG9uOiAodHlwZTogc3RyaW5nLCBjYjogKGRhdGE6IEVycm9yKSA9PiB7fSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYihuZXcgRXJyb3IoXCJJbnZhbGlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzYW5kYm94LnN0dWIoaHR0cHMsIFwiZ2V0XCIpLnJldHVybnMocmVxdWVzdE1vY2spO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IFdlYlNlY3VyZUNsaWVudCgpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBvYmouZ2V0VGV4dChcImh0dHBzOi8vYS5jb21cIik7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBDaGFpLmV4cGVjdChlcnIubWVzc2FnZSkudG8uY29udGFpbihcIkludmFsaWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIHRpbWVvdXRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc29ja2V0TW9jayA9IHtcbiAgICAgICAgICAgICAgICBvbjogKHR5cGU6IHN0cmluZywgY2I6IChkYXRhOiBFcnJvcikgPT4ge30pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwidGltZW91dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYihuZXcgRXJyb3IoXCJJbnZhbGlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0TW9jayA9IHtcbiAgICAgICAgICAgICAgICBvbjogKHR5cGU6IHN0cmluZywgY2I6IChkYXRhOiBhbnkpID0+IHt9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBcInNvY2tldFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYihzb2NrZXRNb2NrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWJvcnQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWJvcnRlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2FuZGJveC5zdHViKGh0dHBzLCBcImdldFwiKS5yZXR1cm5zKHJlcXVlc3RNb2NrKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBXZWJTZWN1cmVDbGllbnQoKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgb2JqLmdldFRleHQoXCJodHRwczovL2EuY29tXCIsIDEpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZXJyLm1lc3NhZ2UpLnRvLmNvbnRhaW4oXCJBYm9ydGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiByZXR1cm4gZGF0YVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZU1vY2sgPSB7XG4gICAgICAgICAgICAgICAgb246ICh0eXBlOiBzdHJpbmcsIGNiOiAoZGF0YTogc3RyaW5nKSA9PiB7fSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJkYXRhXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKFwiaGVsbG9cIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJlbmRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2IoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZ2V0U3R1YiA9IHNhbmRib3guc3R1YihodHRwcywgXCJnZXRcIik7XG4gICAgICAgICAgICBnZXRTdHViLmNhbGxzRmFrZSgodXJsLCBjYikgPT4ge1xuICAgICAgICAgICAgICAgIGNiKHJlc3BvbnNlTW9jayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBXZWJTZWN1cmVDbGllbnQoKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBvYmouZ2V0VGV4dChcImh0dHBzOi8vYS5jb21cIik7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChkYXRhKS50by5jb250YWluKFwiaGVsbG9cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZXRKc29uXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIGFuZCBnZXQgZGF0YVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZU1vY2sgPSB7XG4gICAgICAgICAgICAgICAgb246ICh0eXBlOiBzdHJpbmcsIGNiOiAoZGF0YTogc3RyaW5nKSA9PiB7fSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJkYXRhXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKEpTT04uc3RyaW5naWZ5KHthOiBcImJcIiwgYzogWzEsIDIsIDNdfSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiZW5kXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGdldFN0dWIgPSBzYW5kYm94LnN0dWIoaHR0cHMsIFwiZ2V0XCIpO1xuICAgICAgICAgICAgZ2V0U3R1Yi5jYWxsc0Zha2UoKHVybCwgY2IpID0+IHtcbiAgICAgICAgICAgICAgICBjYihyZXNwb25zZU1vY2spO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgV2ViU2VjdXJlQ2xpZW50KCk7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgb2JqLmdldEpzb24oXCJodHRwczovL2EuY29tXCIpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZGF0YSkudG8uZGVlcC5lcXVhbCh7YTogXCJiXCIsIGM6IFsxLCAyLCAzXX0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl19
