"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for FileLogger.
 */
const Chai = require("chai");
const os = require("os");
const Sinon = require("sinon");
const defaultLogger_1 = require("unitejs-framework/dist/loggers/defaultLogger");
const fileLogger_1 = require("../../../dist/fileLogger");
describe("FileLogger", () => {
    let sandbox;
    let fileSystemStub;
    let fileWriteTextSpy;
    let defaultLoggerStub;
    let logMessages;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
        fileSystemStub = {};
        fileSystemStub.pathGetDirectory = sandbox.stub().returns("test/unit/temp/");
        fileSystemStub.pathGetFilename = sandbox.stub().returns("test.txt");
        fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.directoryCreate = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.fileDelete = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileWriteTextSpy = Sinon.spy(fileSystemStub, "fileWriteText");
        defaultLoggerStub = sandbox.stub(defaultLogger_1.DefaultLogger, "log");
        logMessages = [];
        defaultLoggerStub.callsFake((message) => {
            logMessages.push(message);
        });
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
    }));
    it("can be created", () => {
        const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
        Chai.should().exist(obj);
    });
    describe("initialise", () => {
        it("can be called with existing directory", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(false);
                return obj.closedown();
            }));
        }));
        it("can be called with no existing directory", () => __awaiter(this, void 0, void 0, function* () {
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can be called with existing file", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const fileDeleteSpy = sandbox.spy(fileSystemStub, "fileDelete");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(fileDeleteSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .catch((err) => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(err).not.to.equal(undefined);
                return obj.closedown();
            }));
        }));
    });
    describe("closedown", () => {
        it("can be called even without initialise", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.closedown()
                .then(() => {
                Chai.should().exist(obj);
            });
        }));
    });
    describe("banner", () => {
        it("can be called with null message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(null);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with undefined message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(undefined);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with empty message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("info", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("warning", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("error", () => {
        it("can be called with message, no error and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}`);
        }));
        it("can be called with message, no error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
        it("can be called with message, error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", new Error("@@@kaboom"), { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: \"foo\"${os.EOL}\t\targ2: \"bar\"${os.EOL}EXCEPTION: @@@kaboom${os.EOL}`);
        }));
    });
    describe("flushData", () => {
        it("can call on timer", () => __awaiter(this, void 0, void 0, function* () {
            const setIntervalStub = Sinon.stub(global, "setInterval");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            yield obj.initialise();
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            const flushData = setIntervalStub.args[0][0];
            flushData();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
            yield obj.closedown();
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(logMessages[0]).to.equal("ERROR: Logging To File 'test.txt': kaboom");
        }));
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvZmlsZUxvZ2dlci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7R0FFRztBQUNILDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekIsK0JBQStCO0FBRS9CLGdGQUE2RTtBQUM3RSx3REFBcUQ7QUFFckQsUUFBUSxDQUFDLFlBQVksRUFBRTtJQUNuQixJQUFJLE9BQTJCLENBQUM7SUFDaEMsSUFBSSxjQUEyQixDQUFDO0lBQ2hDLElBQUksZ0JBQWdDLENBQUM7SUFDckMsSUFBSSxpQkFBa0MsQ0FBQztJQUN2QyxJQUFJLFdBQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDO1FBQ1AsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDakMsY0FBYyxHQUFnQixFQUFFLENBQUM7UUFDakMsY0FBYyxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM1RSxjQUFjLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDcEUsY0FBYyxDQUFDLGVBQWUsR0FBRyxDQUFPLGFBQWEsb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBQSxDQUFDO1FBQ2pGLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUEsR0FBQSxDQUFDO1FBQzVFLGNBQWMsQ0FBQyxVQUFVLEdBQUcsQ0FBTyxhQUFhLEVBQUUsUUFBUSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQSxHQUFBLENBQUM7UUFDdEYsY0FBYyxDQUFDLFVBQVUsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUEsR0FBQSxDQUFDO1FBQ2pGLGNBQWMsQ0FBQyxhQUFhLEdBQUcsQ0FBTyxhQUFhLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUEsR0FBQSxDQUFDO1FBRXRHLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBRTlELGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsNkJBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV2RCxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU87WUFDaEMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDO1FBQ04sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3RCLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0JBQWdCLEVBQUU7UUFDakIsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ3RFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsWUFBWSxFQUFFO1FBQ25CLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRTtZQUN4QyxjQUFjLENBQUMsZUFBZSxHQUFHLENBQU8sYUFBYSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBLENBQUM7WUFDaEYsTUFBTSxrQkFBa0IsR0FBbUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUMxRixNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7aUJBQ2xCLElBQUksQ0FBQztnQkFDRixJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3ZELE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDM0IsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMENBQTBDLEVBQUU7WUFDM0MsTUFBTSxrQkFBa0IsR0FBbUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUMxRixNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7aUJBQ2xCLElBQUksQ0FBQztnQkFDRixJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3RELE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDM0IsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUU7WUFDbkMsY0FBYyxDQUFDLFVBQVUsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBLEdBQUEsQ0FBQztZQUNyRixNQUFNLGFBQWEsR0FBbUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFDaEYsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO2lCQUNsQixJQUFJLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDakQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxvQkFBb0IsRUFBRTtZQUNyQixjQUFjLENBQUMsVUFBVSxHQUFHLENBQU8sYUFBYSxFQUFFLFFBQVEsb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxHQUFBLENBQUM7WUFDbkcsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO2lCQUNsQixLQUFLLENBQUMsQ0FBTyxHQUFHO2dCQUNiLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDM0IsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUU7UUFDbEIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFO1lBQ3hDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRTtpQkFDakIsSUFBSSxDQUFDO2dCQUNGLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsUUFBUSxFQUFFO1FBQ2YsRUFBRSxDQUFDLDZDQUE2QyxFQUFFO1lBQzlDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pCLE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrREFBa0QsRUFBRTtZQUNuRCxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOENBQThDLEVBQUU7WUFDL0MsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDZixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUU7WUFDekMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0UsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRTtZQUN0QyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3BELE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0gsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNiLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRTtZQUN6QyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNwQixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2hGLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUU7WUFDdEMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNsRCxNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDaEksQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRTtRQUNoQixFQUFFLENBQUMsd0NBQXdDLEVBQUU7WUFDekMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdkIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNuRixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFO1lBQ3RDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDckQsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ25JLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxPQUFPLEVBQUU7UUFDZCxFQUFFLENBQUMsa0RBQWtELEVBQUU7WUFDbkQsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDckIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFO1lBQ2hELE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQzlELE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqSSxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFO1lBQzdDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDM0UsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsR0FBRyxvQkFBb0IsRUFBRSxDQUFDLEdBQUcsb0JBQW9CLEVBQUUsQ0FBQyxHQUFHLHVCQUF1QixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNsSyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsV0FBVyxFQUFFO1FBQ2xCLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRTtZQUNwQixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztZQUMxRCxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsTUFBTSxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDdkIsR0FBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUM5RCxNQUFNLFNBQVMsR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdDLFNBQVMsRUFBRSxDQUFDO1lBQ1osSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzdILE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0JBQW9CLEVBQUU7WUFDckIsY0FBYyxDQUFDLGFBQWEsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxHQUFBLENBQUM7WUFDeEgsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDckIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7UUFDdEYsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZmlsZUxvZ2dlci5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBmb3IgRmlsZUxvZ2dlci5cbiAqL1xuaW1wb3J0ICogYXMgQ2hhaSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0ICogYXMgb3MgZnJvbSBcIm9zXCI7XG5pbXBvcnQgKiBhcyBTaW5vbiBmcm9tIFwic2lub25cIjtcbmltcG9ydCB7IElGaWxlU3lzdGVtIH0gZnJvbSBcInVuaXRlanMtZnJhbWV3b3JrL2Rpc3QvaW50ZXJmYWNlcy9JRmlsZVN5c3RlbVwiO1xuaW1wb3J0IHsgRGVmYXVsdExvZ2dlciB9IGZyb20gXCJ1bml0ZWpzLWZyYW1ld29yay9kaXN0L2xvZ2dlcnMvZGVmYXVsdExvZ2dlclwiO1xuaW1wb3J0IHsgRmlsZUxvZ2dlciB9IGZyb20gXCIuLi8uLi8uLi9zcmMvZmlsZUxvZ2dlclwiO1xuXG5kZXNjcmliZShcIkZpbGVMb2dnZXJcIiwgKCkgPT4ge1xuICAgIGxldCBzYW5kYm94OiBTaW5vbi5TaW5vblNhbmRib3g7XG4gICAgbGV0IGZpbGVTeXN0ZW1TdHViOiBJRmlsZVN5c3RlbTtcbiAgICBsZXQgZmlsZVdyaXRlVGV4dFNweTogU2lub24uU2lub25TcHk7XG4gICAgbGV0IGRlZmF1bHRMb2dnZXJTdHViOiBTaW5vbi5TaW5vblN0dWI7XG4gICAgbGV0IGxvZ01lc3NhZ2VzOiBzdHJpbmdbXTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBzYW5kYm94ID0gU2lub24uc2FuZGJveC5jcmVhdGUoKTtcbiAgICAgICAgZmlsZVN5c3RlbVN0dWIgPSA8SUZpbGVTeXN0ZW0+e307XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLnBhdGhHZXREaXJlY3RvcnkgPSBzYW5kYm94LnN0dWIoKS5yZXR1cm5zKFwidGVzdC91bml0L3RlbXAvXCIpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5wYXRoR2V0RmlsZW5hbWUgPSBzYW5kYm94LnN0dWIoKS5yZXR1cm5zKFwidGVzdC50eHRcIik7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmRpcmVjdG9yeUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5kaXJlY3RvcnlDcmVhdGUgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVEZWxldGUgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5maWxlV3JpdGVUZXh0ID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUsIGZpbGVOYW1lLCBjb250ZW50cywgYXBwZW5kKSA9PiBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgICAgICBmaWxlV3JpdGVUZXh0U3B5ID0gU2lub24uc3B5KGZpbGVTeXN0ZW1TdHViLCBcImZpbGVXcml0ZVRleHRcIik7XG5cbiAgICAgICAgZGVmYXVsdExvZ2dlclN0dWIgPSBzYW5kYm94LnN0dWIoRGVmYXVsdExvZ2dlciwgXCJsb2dcIik7XG5cbiAgICAgICAgbG9nTWVzc2FnZXMgPSBbXTtcbiAgICAgICAgZGVmYXVsdExvZ2dlclN0dWIuY2FsbHNGYWtlKChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICBsb2dNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjYW4gYmUgY3JlYXRlZFwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICBDaGFpLnNob3VsZCgpLmV4aXN0KG9iaik7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImluaXRpYWxpc2VcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBleGlzdGluZyBkaXJlY3RvcnlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZGlyZWN0b3J5RXhpc3RzID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdG9yeUNyZWF0ZVNweTogU2lub24uU2lub25TcHkgPSBzYW5kYm94LnNweShmaWxlU3lzdGVtU3R1YiwgXCJkaXJlY3RvcnlDcmVhdGVcIik7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouaW5pdGlhbGlzZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBDaGFpLmV4cGVjdChkaXJlY3RvcnlDcmVhdGVTcHkuY2FsbGVkKS50by5lcXVhbChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG5vIGV4aXN0aW5nIGRpcmVjdG9yeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlDcmVhdGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoZmlsZVN5c3RlbVN0dWIsIFwiZGlyZWN0b3J5Q3JlYXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZGlyZWN0b3J5Q3JlYXRlU3B5LmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIGV4aXN0aW5nIGZpbGVcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZmlsZUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgY29uc3QgZmlsZURlbGV0ZVNweTogU2lub24uU2lub25TcHkgPSBzYW5kYm94LnNweShmaWxlU3lzdGVtU3R1YiwgXCJmaWxlRGVsZXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZURlbGV0ZVNweS5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJjYW4gdGhyb3cgYW4gZXJyb3JcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZmlsZUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwia2Fib29tXCIpKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAuY2F0Y2goYXN5bmMgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBDaGFpLmV4cGVjdChlcnIpLm5vdC50by5lcXVhbCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiY2xvc2Vkb3duXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIGV2ZW4gd2l0aG91dCBpbml0aWFsaXNlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiYmFubmVyXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbnVsbCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihudWxsKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwob3MuRU9MKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggdW5kZWZpbmVkIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouYmFubmVyKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKG9zLkVPTCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIGVtcHR5IG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouYmFubmVyKFwiXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChvcy5FT0wpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIoXCJtZXNzYWdlXCIsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYD09PSAgbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJpbmZvXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5pbmZvKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYElORk86IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5pbmZvKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBJTkZPOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIndhcm5pbmdcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLndhcm5pbmcoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgV0FSTklORzogbWVzc2FnZSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLndhcm5pbmcoXCJtZXNzYWdlXCIsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYFdBUk5JTkc6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZXJyb3JcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBubyBlcnJvciBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBubyBlcnJvciBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgdW5kZWZpbmVkLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UsIGVycm9yIGFuZCBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCBuZXcgRXJyb3IoXCJAQEBrYWJvb21cIiksIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYEVSUk9SOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXFxcImZvb1xcXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcXFwiYmFyXFxcIiR7b3MuRU9MfUVYQ0VQVElPTjogQEBAa2Fib29tJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJmbHVzaERhdGFcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBjYWxsIG9uIHRpbWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNldEludGVydmFsU3R1YiA9IFNpbm9uLnN0dWIoZ2xvYmFsLCBcInNldEludGVydmFsXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBhd2FpdCBvYmouaW5pdGlhbGlzZSgpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCB1bmRlZmluZWQsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGNvbnN0IGZsdXNoRGF0YSA9IHNldEludGVydmFsU3R1Yi5hcmdzWzBdWzBdO1xuICAgICAgICAgICAgZmx1c2hEYXRhKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIHRocm93IGFuIGVycm9yXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVXcml0ZVRleHQgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUsIGNvbnRlbnRzLCBhcHBlbmQpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcImthYm9vbVwiKSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChsb2dNZXNzYWdlc1swXSkudG8uZXF1YWwoXCJFUlJPUjogTG9nZ2luZyBUbyBGaWxlICd0ZXN0LnR4dCc6IGthYm9vbVwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdfQ==
