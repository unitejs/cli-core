"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for FileLogger.
 */
const Chai = require("chai");
const os = require("os");
const Sinon = require("sinon");
const defaultLogger_1 = require("unitejs-framework/dist/loggers/defaultLogger");
const fileLogger_1 = require("../../../dist/fileLogger");
describe("FileLogger", () => {
    let sandbox;
    let fileSystemStub;
    let fileWriteTextSpy;
    let defaultLoggerStub;
    let logMessages;
    beforeEach(() => {
        sandbox = Sinon.createSandbox();
        fileSystemStub = {};
        fileSystemStub.pathGetDirectory = sandbox.stub().returns("test/unit/temp/");
        fileSystemStub.pathGetFilename = sandbox.stub().returns("test.txt");
        fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.directoryCreate = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.fileDelete = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileWriteTextSpy = Sinon.spy(fileSystemStub, "fileWriteText");
        defaultLoggerStub = sandbox.stub(defaultLogger_1.DefaultLogger, "log");
        logMessages = [];
        defaultLoggerStub.callsFake((message) => {
            logMessages.push(message);
        });
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
    }));
    it("can be created", () => {
        const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
        Chai.should().exist(obj);
    });
    describe("initialise", () => {
        it("can be called with existing directory", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(false);
                return obj.closedown();
            }));
        }));
        it("can be called with no existing directory", () => __awaiter(this, void 0, void 0, function* () {
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can be called with existing file", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const fileDeleteSpy = sandbox.spy(fileSystemStub, "fileDelete");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(fileDeleteSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .catch((err) => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(err).not.to.equal(undefined);
                return obj.closedown();
            }));
        }));
    });
    describe("closedown", () => {
        it("can be called even without initialise", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.closedown()
                .then(() => {
                Chai.should().exist(obj);
            });
        }));
    });
    describe("banner", () => {
        it("can be called with null message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(null);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with undefined message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(undefined);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with empty message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("info", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("warning", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("error", () => {
        it("can be called with message, no error and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}`);
        }));
        it("can be called with message, no error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
        it("can be called with message, error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", new Error("@@@kaboom"), { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: \"foo\"${os.EOL}\t\targ2: \"bar\"${os.EOL}EXCEPTION: @@@kaboom${os.EOL}`);
        }));
    });
    describe("flushData", () => {
        it("can call on timer", () => __awaiter(this, void 0, void 0, function* () {
            const setIntervalStub = Sinon.stub(global, "setInterval");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            yield obj.initialise();
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            const flushData = setIntervalStub.args[0][0];
            flushData();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
            yield obj.closedown();
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(logMessages[0]).to.equal("ERROR: Logging To File 'test.txt': kaboom");
        }));
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvZmlsZUxvZ2dlci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7R0FFRztBQUNILDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekIsK0JBQStCO0FBRS9CLGdGQUE2RTtBQUM3RSx3REFBcUQ7QUFFckQsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDeEIsSUFBSSxPQUEyQixDQUFDO0lBQ2hDLElBQUksY0FBMkIsQ0FBQztJQUNoQyxJQUFJLGdCQUFnQyxDQUFDO0lBQ3JDLElBQUksaUJBQWtDLENBQUM7SUFDdkMsSUFBSSxXQUFxQixDQUFDO0lBRTFCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixPQUFPLEdBQUcsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ2hDLGNBQWMsR0FBZ0IsRUFBRSxDQUFDO1FBQ2pDLGNBQWMsQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDNUUsY0FBYyxDQUFDLGVBQWUsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BFLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLEVBQUUsRUFBRSxnREFBQyxPQUFBLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBQSxDQUFDO1FBQ2pGLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLEVBQUUsRUFBRSxnREFBQyxPQUFBLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQSxHQUFBLENBQUM7UUFDNUUsY0FBYyxDQUFDLFVBQVUsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLEVBQUUsRUFBRSxnREFBQyxPQUFBLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBQSxDQUFDO1FBQ3RGLGNBQWMsQ0FBQyxV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QUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImZpbGVMb2dnZXIuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIEZpbGVMb2dnZXIuXG4gKi9cbmltcG9ydCAqIGFzIENoYWkgZnJvbSBcImNoYWlcIjtcbmltcG9ydCAqIGFzIG9zIGZyb20gXCJvc1wiO1xuaW1wb3J0ICogYXMgU2lub24gZnJvbSBcInNpbm9uXCI7XG5pbXBvcnQgeyBJRmlsZVN5c3RlbSB9IGZyb20gXCJ1bml0ZWpzLWZyYW1ld29yay9kaXN0L2ludGVyZmFjZXMvSUZpbGVTeXN0ZW1cIjtcbmltcG9ydCB7IERlZmF1bHRMb2dnZXIgfSBmcm9tIFwidW5pdGVqcy1mcmFtZXdvcmsvZGlzdC9sb2dnZXJzL2RlZmF1bHRMb2dnZXJcIjtcbmltcG9ydCB7IEZpbGVMb2dnZXIgfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2ZpbGVMb2dnZXJcIjtcblxuZGVzY3JpYmUoXCJGaWxlTG9nZ2VyXCIsICgpID0+IHtcbiAgICBsZXQgc2FuZGJveDogU2lub24uU2lub25TYW5kYm94O1xuICAgIGxldCBmaWxlU3lzdGVtU3R1YjogSUZpbGVTeXN0ZW07XG4gICAgbGV0IGZpbGVXcml0ZVRleHRTcHk6IFNpbm9uLlNpbm9uU3B5O1xuICAgIGxldCBkZWZhdWx0TG9nZ2VyU3R1YjogU2lub24uU2lub25TdHViO1xuICAgIGxldCBsb2dNZXNzYWdlczogc3RyaW5nW107XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveCA9IFNpbm9uLmNyZWF0ZVNhbmRib3goKTtcbiAgICAgICAgZmlsZVN5c3RlbVN0dWIgPSA8SUZpbGVTeXN0ZW0+e307XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLnBhdGhHZXREaXJlY3RvcnkgPSBzYW5kYm94LnN0dWIoKS5yZXR1cm5zKFwidGVzdC91bml0L3RlbXAvXCIpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5wYXRoR2V0RmlsZW5hbWUgPSBzYW5kYm94LnN0dWIoKS5yZXR1cm5zKFwidGVzdC50eHRcIik7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmRpcmVjdG9yeUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5kaXJlY3RvcnlDcmVhdGUgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVEZWxldGUgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5maWxlV3JpdGVUZXh0ID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUsIGZpbGVOYW1lLCBjb250ZW50cywgYXBwZW5kKSA9PiBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgICAgICBmaWxlV3JpdGVUZXh0U3B5ID0gU2lub24uc3B5KGZpbGVTeXN0ZW1TdHViLCBcImZpbGVXcml0ZVRleHRcIik7XG5cbiAgICAgICAgZGVmYXVsdExvZ2dlclN0dWIgPSBzYW5kYm94LnN0dWIoRGVmYXVsdExvZ2dlciwgXCJsb2dcIik7XG5cbiAgICAgICAgbG9nTWVzc2FnZXMgPSBbXTtcbiAgICAgICAgZGVmYXVsdExvZ2dlclN0dWIuY2FsbHNGYWtlKChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICBsb2dNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjYW4gYmUgY3JlYXRlZFwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICBDaGFpLnNob3VsZCgpLmV4aXN0KG9iaik7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImluaXRpYWxpc2VcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBleGlzdGluZyBkaXJlY3RvcnlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZGlyZWN0b3J5RXhpc3RzID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdG9yeUNyZWF0ZVNweTogU2lub24uU2lub25TcHkgPSBzYW5kYm94LnNweShmaWxlU3lzdGVtU3R1YiwgXCJkaXJlY3RvcnlDcmVhdGVcIik7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouaW5pdGlhbGlzZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBDaGFpLmV4cGVjdChkaXJlY3RvcnlDcmVhdGVTcHkuY2FsbGVkKS50by5lcXVhbChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG5vIGV4aXN0aW5nIGRpcmVjdG9yeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlDcmVhdGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoZmlsZVN5c3RlbVN0dWIsIFwiZGlyZWN0b3J5Q3JlYXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZGlyZWN0b3J5Q3JlYXRlU3B5LmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIGV4aXN0aW5nIGZpbGVcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZmlsZUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgY29uc3QgZmlsZURlbGV0ZVNweTogU2lub24uU2lub25TcHkgPSBzYW5kYm94LnNweShmaWxlU3lzdGVtU3R1YiwgXCJmaWxlRGVsZXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZURlbGV0ZVNweS5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJjYW4gdGhyb3cgYW4gZXJyb3JcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZmlsZVN5c3RlbVN0dWIuZmlsZUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwia2Fib29tXCIpKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAuY2F0Y2goYXN5bmMgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBDaGFpLmV4cGVjdChlcnIpLm5vdC50by5lcXVhbCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiY2xvc2Vkb3duXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIGV2ZW4gd2l0aG91dCBpbml0aWFsaXNlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiYmFubmVyXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbnVsbCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihudWxsKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwob3MuRU9MKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggdW5kZWZpbmVkIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouYmFubmVyKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKG9zLkVPTCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIGVtcHR5IG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouYmFubmVyKFwiXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChvcy5FT0wpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIoXCJtZXNzYWdlXCIsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYD09PSAgbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJpbmZvXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5pbmZvKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYElORk86IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5pbmZvKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBJTkZPOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIndhcm5pbmdcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLndhcm5pbmcoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgV0FSTklORzogbWVzc2FnZSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLndhcm5pbmcoXCJtZXNzYWdlXCIsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYFdBUk5JTkc6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZXJyb3JcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBubyBlcnJvciBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBubyBlcnJvciBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgdW5kZWZpbmVkLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UsIGVycm9yIGFuZCBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCBuZXcgRXJyb3IoXCJAQEBrYWJvb21cIiksIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYEVSUk9SOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXFxcImZvb1xcXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcXFwiYmFyXFxcIiR7b3MuRU9MfUVYQ0VQVElPTjogQEBAa2Fib29tJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJmbHVzaERhdGFcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBjYWxsIG9uIHRpbWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNldEludGVydmFsU3R1YiA9IFNpbm9uLnN0dWIoZ2xvYmFsLCBcInNldEludGVydmFsXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBhd2FpdCBvYmouaW5pdGlhbGlzZSgpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCB1bmRlZmluZWQsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIGNvbnN0IGZsdXNoRGF0YSA9IHNldEludGVydmFsU3R1Yi5hcmdzWzBdWzBdO1xuICAgICAgICAgICAgZmx1c2hEYXRhKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIHRocm93IGFuIGVycm9yXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVXcml0ZVRleHQgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUsIGNvbnRlbnRzLCBhcHBlbmQpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcImthYm9vbVwiKSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChsb2dNZXNzYWdlc1swXSkudG8uZXF1YWwoXCJFUlJPUjogTG9nZ2luZyBUbyBGaWxlICd0ZXN0LnR4dCc6IGthYm9vbVwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdfQ==
