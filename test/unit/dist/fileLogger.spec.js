"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for FileLogger.
 */
const Chai = require("chai");
const fs = require("fs");
const os = require("os");
const Sinon = require("sinon");
const fileLogger_1 = require("../../../dist/fileLogger");
describe("FileLogger", () => {
    let sandbox;
    let stubExistsMethod;
    let stubDeleteMethod;
    let stubAppendMethod;
    let originalConsoleLog;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
        stubExistsMethod = sandbox.stub(fs, "existsSync");
        stubDeleteMethod = sandbox.stub(fs, "unlinkSync");
        stubAppendMethod = sandbox.stub(fs, "appendFileSync");
        originalConsoleLog = console.log;
        console.log = (message, ...optionalParams) => {
            if (message && message.indexOf("@@@") < 0) {
                originalConsoleLog(message, ...optionalParams);
            }
        };
    });
    afterEach(() => {
        sandbox.restore();
        console.log = originalConsoleLog;
    });
    it("can be created", () => {
        const obj = new fileLogger_1.FileLogger("log.txt");
        Chai.should().exist(obj);
    });
    it("can skip deleting log", () => {
        stubExistsMethod.onCall(0).returns(false);
        const obj = new fileLogger_1.FileLogger("log.txt");
        Chai.should().exist(obj);
        Chai.expect(stubExistsMethod.called).to.equal(true);
        Chai.expect(stubDeleteMethod.called).to.equal(false);
    });
    it("can delete existing log", () => {
        stubExistsMethod.onCall(0).returns(true);
        const obj = new fileLogger_1.FileLogger("log.txt");
        Chai.should().exist(obj);
        Chai.expect(stubExistsMethod.called).to.equal(true);
        Chai.expect(stubDeleteMethod.called).to.equal(true);
    });
    it("can delete throws error", () => {
        stubExistsMethod.onCall(0).throws(new Error("@@@kaboom"));
        const obj = new fileLogger_1.FileLogger("log.txt");
        Chai.should().exist(obj);
        Chai.expect(stubExistsMethod.called).to.equal(true);
        Chai.expect(stubDeleteMethod.called).to.equal(false);
    });
    describe("banner", () => {
        it("can be called with null message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner(null);
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(os.EOL);
        });
        it("can be called with undefined message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner(undefined);
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(os.EOL);
        });
        it("can be called with empty message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner("");
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(os.EOL);
        });
        it("can be called with message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner("message");
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`===  message${os.EOL}`);
        });
        it("can be called with message and args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        });
        it("can throw error while writing", () => {
            stubAppendMethod.onCall(0).throws(new Error("@@@kaboom"));
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        });
    });
    describe("info", () => {
        it("can be called with message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.info("message");
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`INFO: message${os.EOL}`);
        });
        it("can be called with message and args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.info("message", { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`INFO: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        });
    });
    describe("warning", () => {
        it("can be called with message and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.warning("message");
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`WARNING: message${os.EOL}`);
        });
        it("can be called with message and args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.warning("message", { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`WARNING: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        });
    });
    describe("error", () => {
        it("can be called with message, no error and no args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.error("message");
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`ERROR: message${os.EOL}`);
        });
        it("can be called with message, no error and args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        });
        it("can be called with message, error and args", () => {
            const obj = new fileLogger_1.FileLogger("log.txt");
            obj.error("message", new Error("@@@kaboom"), { arg1: "foo", arg2: "bar" });
            Chai.expect(stubAppendMethod.args[0][1]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
            Chai.expect(stubAppendMethod.args[1][1]).to.equal(`EXCEPTION: @@@kaboom${os.EOL}`);
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvZmlsZUxvZ2dlci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCLHlCQUF5QjtBQUN6QiwrQkFBK0I7QUFDL0IseURBQXNEO0FBRXRELFFBQVEsQ0FBQyxZQUFZLEVBQUU7SUFDbkIsSUFBSSxPQUEyQixDQUFDO0lBQ2hDLElBQUksZ0JBQWlDLENBQUM7SUFDdEMsSUFBSSxnQkFBaUMsQ0FBQztJQUN0QyxJQUFJLGdCQUFpQyxDQUFDO0lBQ3RDLElBQUksa0JBQXFFLENBQUM7SUFFMUUsVUFBVSxDQUFDO1FBQ1AsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDakMsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDbEQsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDbEQsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUN0RCxrQkFBa0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFhLEVBQUUsR0FBRyxjQUFxQjtZQUNsRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN4QyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxjQUFjLENBQUMsQ0FBQztZQUNuRCxDQUFDO1FBQ0wsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUM7UUFDTixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbEIsT0FBTyxDQUFD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QUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOENBQThDLEVBQUU7WUFDL0MsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFO1lBQ3pDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9FLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFO1lBQ3RDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7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QUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDakksQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUU7WUFDN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RDLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMzRSxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDN0gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN2RixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZmlsZUxvZ2dlci5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBmb3IgRmlsZUxvZ2dlci5cbiAqL1xuaW1wb3J0ICogYXMgQ2hhaSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBvcyBmcm9tIFwib3NcIjtcbmltcG9ydCAqIGFzIFNpbm9uIGZyb20gXCJzaW5vblwiO1xuaW1wb3J0IHsgRmlsZUxvZ2dlciB9IGZyb20gXCIuLi8uLi8uLi9kaXN0L2ZpbGVMb2dnZXJcIjtcblxuZGVzY3JpYmUoXCJGaWxlTG9nZ2VyXCIsICgpID0+IHtcbiAgICBsZXQgc2FuZGJveDogU2lub24uU2lub25TYW5kYm94O1xuICAgIGxldCBzdHViRXhpc3RzTWV0aG9kOiBTaW5vbi5TaW5vblN0dWI7XG4gICAgbGV0IHN0dWJEZWxldGVNZXRob2Q6IFNpbm9uLlNpbm9uU3R1YjtcbiAgICBsZXQgc3R1YkFwcGVuZE1ldGhvZDogU2lub24uU2lub25TdHViO1xuICAgIGxldCBvcmlnaW5hbENvbnNvbGVMb2c6IChtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pID0+IHZvaWQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveCA9IFNpbm9uLnNhbmRib3guY3JlYXRlKCk7XG4gICAgICAgIHN0dWJFeGlzdHNNZXRob2QgPSBzYW5kYm94LnN0dWIoZnMsIFwiZXhpc3RzU3luY1wiKTtcbiAgICAgICAgc3R1YkRlbGV0ZU1ldGhvZCA9IHNhbmRib3guc3R1YihmcywgXCJ1bmxpbmtTeW5jXCIpO1xuICAgICAgICBzdHViQXBwZW5kTWV0aG9kID0gc2FuZGJveC5zdHViKGZzLCBcImFwcGVuZEZpbGVTeW5jXCIpO1xuICAgICAgICBvcmlnaW5hbENvbnNvbGVMb2cgPSBjb25zb2xlLmxvZztcbiAgICAgICAgY29uc29sZS5sb2cgPSAobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlLmluZGV4T2YoXCJAQEBcIikgPCAwKSB7XG4gICAgICAgICAgICAgICAgb3JpZ2luYWxDb25zb2xlTG9nKG1lc3NhZ2UsIC4uLm9wdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyA9IG9yaWdpbmFsQ29uc29sZUxvZztcbiAgICB9KTtcblxuICAgIGl0KFwiY2FuIGJlIGNyZWF0ZWRcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgIENoYWkuc2hvdWxkKCkuZXhpc3Qob2JqKTtcbiAgICB9KTtcblxuICAgIGl0KFwiY2FuIHNraXAgZGVsZXRpbmcgbG9nXCIsICgpID0+IHtcbiAgICAgICAgc3R1YkV4aXN0c01ldGhvZC5vbkNhbGwoMCkucmV0dXJucyhmYWxzZSk7XG4gICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwibG9nLnR4dFwiKTtcbiAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgICAgICBDaGFpLmV4cGVjdChzdHViRXhpc3RzTWV0aG9kLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAgIENoYWkuZXhwZWN0KHN0dWJEZWxldGVNZXRob2QuY2FsbGVkKS50by5lcXVhbChmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdChcImNhbiBkZWxldGUgZXhpc3RpbmcgbG9nXCIsICgpID0+IHtcbiAgICAgICAgc3R1YkV4aXN0c01ldGhvZC5vbkNhbGwoMCkucmV0dXJucyh0cnVlKTtcbiAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICBDaGFpLnNob3VsZCgpLmV4aXN0KG9iaik7XG4gICAgICAgIENoYWkuZXhwZWN0KHN0dWJFeGlzdHNNZXRob2QuY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkRlbGV0ZU1ldGhvZC5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjYW4gZGVsZXRlIHRocm93cyBlcnJvclwiLCAoKSA9PiB7XG4gICAgICAgIHN0dWJFeGlzdHNNZXRob2Qub25DYWxsKDApLnRocm93cyhuZXcgRXJyb3IoXCJAQEBrYWJvb21cIikpO1xuICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgIENoYWkuc2hvdWxkKCkuZXhpc3Qob2JqKTtcbiAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkV4aXN0c01ldGhvZC5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICBDaGFpLmV4cGVjdChzdHViRGVsZXRlTWV0aG9kLmNhbGxlZCkudG8uZXF1YWwoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJiYW5uZXJcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBudWxsIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihudWxsKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1swXVsxXSkudG8uZXF1YWwob3MuRU9MKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggdW5kZWZpbmVkIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcih1bmRlZmluZWQpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkFwcGVuZE1ldGhvZC5hcmdzWzBdWzFdKS50by5lcXVhbChvcy5FT0wpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBlbXB0eSBtZXNzYWdlIGFuZCBubyBhcmdzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwibG9nLnR4dFwiKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIoXCJcIik7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChzdHViQXBwZW5kTWV0aG9kLmFyZ3NbMF1bMV0pLnRvLmVxdWFsKG9zLkVPTCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChzdHViQXBwZW5kTWV0aG9kLmFyZ3NbMF1bMV0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgICAgICBvYmouYmFubmVyKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChzdHViQXBwZW5kTWV0aG9kLmFyZ3NbMF1bMV0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiB0aHJvdyBlcnJvciB3aGlsZSB3cml0aW5nXCIsICgpID0+IHtcbiAgICAgICAgICAgIHN0dWJBcHBlbmRNZXRob2Qub25DYWxsKDApLnRocm93cyhuZXcgRXJyb3IoXCJAQEBrYWJvb21cIikpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIm1lc3NhZ2VcIiwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkFwcGVuZE1ldGhvZC5hcmdzWzBdWzFdKS50by5lcXVhbChgPT09ICBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImluZm9cIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwibG9nLnR4dFwiKTtcbiAgICAgICAgICAgIG9iai5pbmZvKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1swXVsxXSkudG8uZXF1YWwoYElORk86IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgICAgICBvYmouaW5mbyhcIm1lc3NhZ2VcIiwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkFwcGVuZE1ldGhvZC5hcmdzWzBdWzFdKS50by5lcXVhbChgSU5GTzogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ3YXJuaW5nXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgICAgICBvYmoud2FybmluZyhcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChzdHViQXBwZW5kTWV0aG9kLmFyZ3NbMF1bMV0pLnRvLmVxdWFsKGBXQVJOSU5HOiBtZXNzYWdlJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLndhcm5pbmcoXCJtZXNzYWdlXCIsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1swXVsxXSkudG8uZXF1YWwoYFdBUk5JTkc6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZXJyb3JcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBubyBlcnJvciBhbmQgbm8gYXJnc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcImxvZy50eHRcIik7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3Qoc3R1YkFwcGVuZE1ldGhvZC5hcmdzWzBdWzFdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgbm8gZXJyb3IgYW5kIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCB1bmRlZmluZWQsIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1swXVsxXSkudG8uZXF1YWwoYEVSUk9SOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgZXJyb3IgYW5kIGFyZ3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJsb2cudHh0XCIpO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiLCBuZXcgRXJyb3IoXCJAQEBrYWJvb21cIiksIHsgYXJnMTogXCJmb29cIiwgYXJnMjogXCJiYXJcIiB9KTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1swXVsxXSkudG8uZXF1YWwoYEVSUk9SOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KHN0dWJBcHBlbmRNZXRob2QuYXJnc1sxXVsxXSkudG8uZXF1YWwoYEVYQ0VQVElPTjogQEBAa2Fib29tJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
