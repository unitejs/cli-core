"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for FileLogger.
 */
const Chai = require("chai");
const os = require("os");
const Sinon = require("sinon");
const defaultLogger_1 = require("unitejs-framework/dist/loggers/defaultLogger");
const fileLogger_1 = require("../../../dist/fileLogger");
describe("FileLogger", () => {
    let sandbox;
    let fileSystemStub;
    let fileWriteTextSpy;
    let defaultLoggerStub;
    let logMessages;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
        fileSystemStub = {};
        fileSystemStub.pathGetDirectory = sandbox.stub().returns("test/unit/temp/");
        fileSystemStub.pathGetFilename = sandbox.stub().returns("test.txt");
        fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.directoryCreate = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        fileSystemStub.fileDelete = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileWriteTextSpy = Sinon.spy(fileSystemStub, "fileWriteText");
        defaultLoggerStub = sandbox.stub(defaultLogger_1.DefaultLogger, "log");
        logMessages = [];
        defaultLoggerStub.callsFake((message) => {
            logMessages.push(message);
        });
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
    }));
    it("can be created", () => {
        const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
        Chai.should().exist(obj);
    });
    describe("initialise", () => {
        it("can be called with existing directory", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(false);
                return obj.closedown();
            }));
        }));
        it("can be called with no existing directory", () => __awaiter(this, void 0, void 0, function* () {
            const directoryCreateSpy = sandbox.spy(fileSystemStub, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can be called with existing file", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const fileDeleteSpy = sandbox.spy(fileSystemStub, "fileDelete");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(fileDeleteSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.initialise()
                .catch((err) => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(err).not.to.equal(undefined);
                return obj.closedown();
            }));
        }));
    });
    describe("closedown", () => {
        it("can be called even without initialise", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            return obj.closedown()
                .then(() => {
                Chai.should().exist(obj);
            });
        }));
    });
    describe("banner", () => {
        it("can be called with null message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(null);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with undefined message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner(undefined);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with empty message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("info", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.info("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("warning", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.warning("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("error", () => {
        it("can be called with message, no error and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}`);
        }));
        it("can be called with message, no error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
        it("can be called with message, error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message", new Error("@@@kaboom"), { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: \"foo\"${os.EOL}\t\targ2: \"bar\"${os.EOL}EXCEPTION: @@@kaboom${os.EOL}`);
        }));
    });
    describe("flushData", () => {
        it("can call on timer", () => __awaiter(this, void 0, void 0, function* () {
            const setIntervalStub = Sinon.stub(global, "setInterval");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            yield obj.initialise();
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            const flushData = setIntervalStub.args[0][0];
            flushData();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
            yield obj.closedown();
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            fileSystemStub.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", fileSystemStub);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(logMessages[0]).to.equal("ERROR: Logging To File 'test.txt': kaboom");
        }));
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvZmlsZUxvZ2dlci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7R0FFRztBQUNILDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekIsK0JBQStCO0FBRS9CLGdGQUE2RTtBQUM3RSx5REFBc0Q7QUFFdEQsUUFBUSxDQUFDLFlBQVksRUFBRTtJQUNuQixJQUFJLE9BQTJCLENBQUM7SUFDaEMsSUFBSSxjQUEyQixDQUFDO0lBQ2hDLElBQUksZ0JBQWdDLENBQUM7SUFDckMsSUFBSSxpQkFBa0MsQ0FBQztJQUN2QyxJQUFJLFdBQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDO1FBQ1AsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDakMsY0FBYyxHQUFnQixFQUFFLENBQUM7UUFDakMsY0FBYyxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM1RSxjQUFjLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDcEUsY0FBYyxDQUFDLGVBQWUsR0FBRyxDQUFPLGFBQWEsb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBQSxDQUFDO1FBQ2pGLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUEsR0FBQSxDQUFDO1FBQzVFLGNBQWMsQ0FBQyxVQUFVLEdBQUcsQ0FBTyxhQUFhLEVBQUUsUUFBUSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQSxHQUFBLENBQUM7UUFDdEYsY0FBYyxDQUFDLFVBQVUsR0FBRyxDQUFPLGFBQWEsRUFBRSxR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LEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzdILE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0JBQW9CLEVBQUU7WUFDckIsY0FBYyxDQUFDLGFBQWEsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxHQUFBLENBQUM7WUFDeEgsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDckIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7UUFDdEYsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZmlsZUxvZ2dlci5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBmb3IgRmlsZUxvZ2dlci5cbiAqL1xuaW1wb3J0ICogYXMgQ2hhaSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0ICogYXMgb3MgZnJvbSBcIm9zXCI7XG5pbXBvcnQgKiBhcyBTaW5vbiBmcm9tIFwic2lub25cIjtcbmltcG9ydCB7IElGaWxlU3lzdGVtIH0gZnJvbSBcInVuaXRlanMtZnJhbWV3b3JrL2Rpc3QvaW50ZXJmYWNlcy9JRmlsZVN5c3RlbVwiO1xuaW1wb3J0IHsgRGVmYXVsdExvZ2dlciB9IGZyb20gXCJ1bml0ZWpzLWZyYW1ld29yay9kaXN0L2xvZ2dlcnMvZGVmYXVsdExvZ2dlclwiO1xuaW1wb3J0IHsgRmlsZUxvZ2dlciB9IGZyb20gXCIuLi8uLi8uLi9kaXN0L2ZpbGVMb2dnZXJcIjtcblxuZGVzY3JpYmUoXCJGaWxlTG9nZ2VyXCIsICgpID0+IHtcbiAgICBsZXQgc2FuZGJveDogU2lub24uU2lub25TYW5kYm94O1xuICAgIGxldCBmaWxlU3lzdGVtU3R1YjogSUZpbGVTeXN0ZW07XG4gICAgbGV0IGZpbGVXcml0ZVRleHRTcHk6IFNpbm9uLlNpbm9uU3B5O1xuICAgIGxldCBkZWZhdWx0TG9nZ2VyU3R1YjogU2lub24uU2lub25TdHViO1xuICAgIGxldCBsb2dNZXNzYWdlczogc3RyaW5nW107XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveCA9IFNpbm9uLnNhbmRib3guY3JlYXRlKCk7XG4gICAgICAgIGZpbGVTeXN0ZW1TdHViID0gPElGaWxlU3lzdGVtPnt9O1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5wYXRoR2V0RGlyZWN0b3J5ID0gc2FuZGJveC5zdHViKCkucmV0dXJucyhcInRlc3QvdW5pdC90ZW1wL1wiKTtcbiAgICAgICAgZmlsZVN5c3RlbVN0dWIucGF0aEdldEZpbGVuYW1lID0gc2FuZGJveC5zdHViKCkucmV0dXJucyhcInRlc3QudHh0XCIpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5kaXJlY3RvcnlFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgZmlsZVN5c3RlbVN0dWIuZGlyZWN0b3J5Q3JlYXRlID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5maWxlRXhpc3RzID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUsIGZpbGVOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICAgICAgICBmaWxlU3lzdGVtU3R1Yi5maWxlRGVsZXRlID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUsIGZpbGVOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgZmlsZVN5c3RlbVN0dWIuZmlsZVdyaXRlVGV4dCA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSwgY29udGVudHMsIGFwcGVuZCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG5cbiAgICAgICAgZmlsZVdyaXRlVGV4dFNweSA9IFNpbm9uLnNweShmaWxlU3lzdGVtU3R1YiwgXCJmaWxlV3JpdGVUZXh0XCIpO1xuXG4gICAgICAgIGRlZmF1bHRMb2dnZXJTdHViID0gc2FuZGJveC5zdHViKERlZmF1bHRMb2dnZXIsIFwibG9nXCIpO1xuXG4gICAgICAgIGxvZ01lc3NhZ2VzID0gW107XG4gICAgICAgIGRlZmF1bHRMb2dnZXJTdHViLmNhbGxzRmFrZSgobWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgbG9nTWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiY2FuIGJlIGNyZWF0ZWRcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJpbml0aWFsaXNlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggZXhpc3RpbmcgZGlyZWN0b3J5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW1TdHViLmRpcmVjdG9yeUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlDcmVhdGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoZmlsZVN5c3RlbVN0dWIsIFwiZGlyZWN0b3J5Q3JlYXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZGlyZWN0b3J5Q3JlYXRlU3B5LmNhbGxlZCkudG8uZXF1YWwoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBubyBleGlzdGluZyBkaXJlY3RvcnlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGlyZWN0b3J5Q3JlYXRlU3B5OiBTaW5vbi5TaW5vblNweSA9IHNhbmRib3guc3B5KGZpbGVTeXN0ZW1TdHViLCBcImRpcmVjdG9yeUNyZWF0ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuZXhwZWN0KGRpcmVjdG9yeUNyZWF0ZVNweS5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBleGlzdGluZyBmaWxlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVEZWxldGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoZmlsZVN5c3RlbVN0dWIsIFwiZmlsZURlbGV0ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVEZWxldGVTcHkuY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiY2FuIHRocm93IGFuIGVycm9yXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGZpbGVTeXN0ZW1TdHViLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcImthYm9vbVwiKSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouaW5pdGlhbGlzZSgpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGFzeW5jIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZXJyKS5ub3QudG8uZXF1YWwodW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImNsb3NlZG93blwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCBldmVuIHdpdGhvdXQgaW5pdGlhbGlzZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuc2hvdWxkKCkuZXhpc3Qob2JqKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImJhbm5lclwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG51bGwgbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIobnVsbCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKG9zLkVPTCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIHVuZGVmaW5lZCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcih1bmRlZmluZWQpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChvcy5FT0wpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBlbXB0eSBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIlwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwob3MuRU9MKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgPT09ICBtZXNzYWdlJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouYmFubmVyKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiaW5mb1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouaW5mbyhcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBJTkZPOiBtZXNzYWdlJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouaW5mbyhcIm1lc3NhZ2VcIiwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgSU5GTzogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ3YXJuaW5nXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai53YXJuaW5nKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYFdBUk5JTkc6IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai53YXJuaW5nKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBXQVJOSU5HOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImVycm9yXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgbm8gZXJyb3IgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgbm8gZXJyb3IgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIsIHVuZGVmaW5lZCwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBlcnJvciBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIGZpbGVTeXN0ZW1TdHViKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgbmV3IEVycm9yKFwiQEBAa2Fib29tXCIpLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFxcXCJmb29cXFwiJHtvcy5FT0x9XFx0XFx0YXJnMjogXFxcImJhclxcXCIke29zLkVPTH1FWENFUFRJT046IEBAQGthYm9vbSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZmx1c2hEYXRhXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gY2FsbCBvbiB0aW1lclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZXRJbnRlcnZhbFN0dWIgPSBTaW5vbi5zdHViKGdsb2JhbCwgXCJzZXRJbnRlcnZhbFwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgZmlsZVN5c3RlbVN0dWIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmluaXRpYWxpc2UoKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgdW5kZWZpbmVkLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBjb25zdCBmbHVzaERhdGEgPSBzZXRJbnRlcnZhbFN0dWIuYXJnc1swXVswXTtcbiAgICAgICAgICAgIGZsdXNoRGF0YSgpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiB0aHJvdyBhbiBlcnJvclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBmaWxlU3lzdGVtU3R1Yi5maWxlV3JpdGVUZXh0ID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUsIGZpbGVOYW1lLCBjb250ZW50cywgYXBwZW5kKSA9PiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJrYWJvb21cIikpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBmaWxlU3lzdGVtU3R1Yik7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QobG9nTWVzc2FnZXNbMF0pLnRvLmVxdWFsKFwiRVJST1I6IExvZ2dpbmcgVG8gRmlsZSAndGVzdC50eHQnOiBrYWJvb21cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
