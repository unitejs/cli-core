"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Tests for FileLogger.
 */
const Chai = require("chai");
const os = require("os");
const Sinon = require("sinon");
const fileLogger_1 = require("../../../dist/fileLogger");
describe("FileLogger", () => {
    let sandbox;
    let stubFileSystem;
    let fileWriteTextSpy;
    let originalConsoleLog;
    beforeEach(() => {
        sandbox = Sinon.sandbox.create();
        stubFileSystem = {};
        stubFileSystem.pathGetDirectory = sandbox.stub().returns("test/unit/temp/");
        stubFileSystem.pathGetFilename = sandbox.stub().returns("test.txt");
        stubFileSystem.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        stubFileSystem.directoryCreate = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        stubFileSystem.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(false); });
        stubFileSystem.fileDelete = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        stubFileSystem.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(); });
        fileWriteTextSpy = Sinon.spy(stubFileSystem, "fileWriteText");
        originalConsoleLog = console.log;
        console.log = (message, ...optionalParams) => {
            if (message && message.indexOf("@@@") < 0 && !message.startsWith("ERROR: ")) {
                originalConsoleLog(message, ...optionalParams);
            }
        };
    });
    afterEach(() => __awaiter(this, void 0, void 0, function* () {
        sandbox.restore();
        console.log = originalConsoleLog;
    }));
    it("can be created", () => {
        const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
        Chai.should().exist(obj);
    });
    describe("initialise", () => {
        it("can be called with existing directory", () => __awaiter(this, void 0, void 0, function* () {
            stubFileSystem.directoryExists = (directoryName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const directoryCreateSpy = sandbox.spy(stubFileSystem, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(false);
                return obj.closedown();
            }));
        }));
        it("can be called with no existing directory", () => __awaiter(this, void 0, void 0, function* () {
            const directoryCreateSpy = sandbox.spy(stubFileSystem, "directoryCreate");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(directoryCreateSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can be called with existing file", () => __awaiter(this, void 0, void 0, function* () {
            stubFileSystem.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.resolve(true); });
            const fileDeleteSpy = sandbox.spy(stubFileSystem, "fileDelete");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            return obj.initialise()
                .then(() => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(fileDeleteSpy.called).to.equal(true);
                return obj.closedown();
            }));
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            stubFileSystem.fileExists = (directoryName, fileName) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            return obj.initialise()
                .catch((err) => __awaiter(this, void 0, void 0, function* () {
                Chai.expect(err).not.to.equal(undefined);
                return obj.closedown();
            }));
        }));
    });
    describe("closedown", () => {
        it("can be called even without initialise", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            return obj.closedown()
                .then(() => {
                Chai.should().exist(obj);
            });
        }));
    });
    describe("banner", () => {
        it("can be called with null message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.banner(null);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with undefined message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.banner(undefined);
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with empty message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.banner("");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(os.EOL);
        }));
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.banner("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.banner("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`===  message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("info", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.info("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.info("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`INFO: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("warning", () => {
        it("can be called with message and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.warning("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}`);
        }));
        it("can be called with message and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.warning("message", { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`WARNING: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
    });
    describe("error", () => {
        it("can be called with message, no error and no args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}`);
        }));
        it("can be called with message, no error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
        }));
        it("can be called with message, error and args", () => __awaiter(this, void 0, void 0, function* () {
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.error("message", new Error("@@@kaboom"), { arg1: "foo", arg2: "bar" });
            yield obj.closedown();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: \"foo\"${os.EOL}\t\targ2: \"bar\"${os.EOL}EXCEPTION: @@@kaboom${os.EOL}`);
        }));
    });
    describe("flushData", () => {
        it("can call on timer", () => __awaiter(this, void 0, void 0, function* () {
            const setIntervalStub = Sinon.stub(global, "setInterval");
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            yield obj.initialise();
            obj.error("message", undefined, { arg1: "foo", arg2: "bar" });
            const flushData = setIntervalStub.args[0][0];
            flushData();
            Chai.expect(fileWriteTextSpy.args[0][2]).to.equal(`ERROR: message${os.EOL}\t\targ1: "foo"${os.EOL}\t\targ2: "bar"${os.EOL}`);
            yield obj.closedown();
        }));
        it("can throw an error", () => __awaiter(this, void 0, void 0, function* () {
            const consoleLogSpy = sandbox.spy(console, "log");
            stubFileSystem.fileWriteText = (directoryName, fileName, contents, append) => __awaiter(this, void 0, void 0, function* () { return Promise.reject(new Error("kaboom")); });
            const obj = new fileLogger_1.FileLogger("test/unit/temp/test.txt", stubFileSystem);
            obj.error("message");
            yield obj.closedown();
            Chai.expect(consoleLogSpy.args[0][0]).to.equal("ERROR: Logging To File 'test.txt': kaboom");
        }));
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9zcmMvZmlsZUxvZ2dlci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7R0FFRztBQUNILDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekIsK0JBQStCO0FBRS9CLHlEQUFzRDtBQUV0RCxRQUFRLENBQUMsWUFBWSxFQUFFO0lBQ25CLElBQUksT0FBMkIsQ0FBQztJQUNoQyxJQUFJLGNBQTJCLENBQUM7SUFDaEMsSUFBSSxnQkFBZ0MsQ0FBQztJQUNyQyxJQUFJLGtCQUFxRSxDQUFDO0lBRTFFLFVBQVUsQ0FBQztRQUNQLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2pDLGNBQWMsR0FBZ0IsRUFBRSxDQUFDO1FBQ2pDLGNBQWMsQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDNUUsY0FBYyxDQUFDLGVBQWUsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BFLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBLEdBQUEsQ0FBQztRQUNqRixjQUFjLENBQUMsZUFBZSxHQUFHLENBQU8sYUFBYSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBLEdBQUEsQ0FBQztRQUM1RSxjQUFjLENBQUMsVUFBVSxHQUFHLENBQU8sYUFBYSxFQUFFLFFBQVEsb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBQSxDQUFDO1FBQ3RGLGNBQWMsQ0FBQyxVQUFVLEdBQUcsQ0FBTyxhQUFhLEVBQUUsUUFBUSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBLEdBQUEsQ0FBQztRQUNqRixjQUFjLENBQUMsYUFBYSxHQUFHLENBQU8sYUFBYSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBLEdBQUEsQ0FBQztRQUV0RyxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxlQUFlLENBQUMsQ0FBQztRQUU5RCxrQkFBa0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFhLEVBQUUsR0FBRyxjQUFxQjtZQUNsRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUUsa0JBQWtCLENBQUMsT0FBTyxFQUFFLEdBQUcsY0FBYyxDQUFDLENBQUM7WUFDbkQsQ0FBQztRQUNMLENBQUMsQ0FBQztJQUNOLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDO1FBQ04sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2xCLE9BQU8sQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUM7SUFDckMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRTtRQUNqQixNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxZQUFZLEVBQUU7UUFDbkIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFO1lBQ3hDLGNBQWMsQ0FBQyxlQUFlLEdBQUcsQ0FBTyxhQUFhLG9EQUFLLE1BQU0sQ0FBTixPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBLEdBQUEsQ0FBQztZQUNoRixNQUFNLGtCQUFrQixHQUFtQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBQzFGLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRTtpQkFDbEIsSUFBSSxDQUFDO2dCQUNGLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDdkQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRTtZQUMzQyxNQUFNLGtCQUFrQixHQUFtQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBQzFGLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRTtpQkFDbEIsSUFBSSxDQUFDO2dCQUNGLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRTtZQUNuQyxjQUFjLENBQUMsVUFBVSxHQUFHLENBQU8sYUFBYSxFQUFFLFFBQVEsb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUEsR0FBQSxDQUFDO1lBQ3JGLE1BQU0sYUFBYSxHQUFtQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUNoRixNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7aUJBQ2xCLElBQUksQ0FBQztnQkFDRixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQzNCLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLG9CQUFvQixFQUFFO1lBQ3JCLGNBQWMsQ0FBQyxVQUFVLEdBQUcsQ0FBTyxhQUFhLEVBQUUsUUFBUSxvREFBSyxNQUFNLENBQU4sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBLEdBQUEsQ0FBQztZQUNuRyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7aUJBQ2xCLEtBQUssQ0FBQyxDQUFPLEdBQUc7Z0JBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDekMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRTtRQUNsQixFQUFFLENBQUMsdUNBQXVDLEVBQUU7WUFDeEMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFO2lCQUNqQixJQUFJLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3QixDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDZixFQUFFLENBQUMsNkNBQTZDLEVBQUU7WUFDOUMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtEQUFrRCxFQUFFO1lBQ25ELE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RCLE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRTtZQUMvQyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNmLE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRTtZQUN6QyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMvRSxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFO1lBQ3RDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDcEQsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMvSCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsTUFBTSxFQUFFO1FBQ2IsRUFBRSxDQUFDLHdDQUF3QyxFQUFFO1lBQ3pDLE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3BCLE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDaEYsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRTtZQUN0QyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNoSSxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFO1FBQ2hCLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRTtZQUN6QyxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN2QixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUU7WUFDdEMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNyRCxNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDbkksQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLE9BQU8sRUFBRTtRQUNkLEVBQUUsQ0FBQyxrREFBa0QsRUFBRTtZQUNuRCxNQUFNLEdBQUcsR0FBRyxJQUFJLHVCQUFVLENBQUMseUJBQXlCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEUsR0FBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNyQixNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pGLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUU7WUFDaEQsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDOUQsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pJLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUU7WUFDN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMzRSxNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxHQUFHLG9CQUFvQixFQUFFLENBQUMsR0FBRyxvQkFBb0IsRUFBRSxDQUFDLEdBQUcsdUJBQXVCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2xLLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUU7UUFDbEIsRUFBRSxDQUFDLG1CQUFtQixFQUFFO1lBQ3BCLE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBQzFELE1BQU0sR0FBRyxHQUFHLElBQUksdUJBQVUsQ0FBQyx5QkFBeUIsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN0RSxNQUFNLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN2QixHQUFHLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQzlELE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0MsU0FBUyxFQUFFLENBQUM7WUFDWixJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDN0gsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDMUIsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQkFBb0IsRUFBRTtZQUNyQixNQUFNLGFBQWEsR0FBbUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDbEUsY0FBYyxDQUFDLGFBQWEsR0FBRyxDQUFPLGFBQWEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0RBQUssTUFBTSxDQUFOLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxHQUFBLENBQUM7WUFDeEgsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBVSxDQUFDLHlCQUF5QixFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ3RFLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDckIsTUFBTSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO1FBQ2hHLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImZpbGVMb2dnZXIuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIEZpbGVMb2dnZXIuXG4gKi9cbmltcG9ydCAqIGFzIENoYWkgZnJvbSBcImNoYWlcIjtcbmltcG9ydCAqIGFzIG9zIGZyb20gXCJvc1wiO1xuaW1wb3J0ICogYXMgU2lub24gZnJvbSBcInNpbm9uXCI7XG5pbXBvcnQgeyBJRmlsZVN5c3RlbSB9IGZyb20gXCJ1bml0ZWpzLWZyYW1ld29yay9kaXN0L2ludGVyZmFjZXMvSUZpbGVTeXN0ZW1cIjtcbmltcG9ydCB7IEZpbGVMb2dnZXIgfSBmcm9tIFwiLi4vLi4vLi4vZGlzdC9maWxlTG9nZ2VyXCI7XG5cbmRlc2NyaWJlKFwiRmlsZUxvZ2dlclwiLCAoKSA9PiB7XG4gICAgbGV0IHNhbmRib3g6IFNpbm9uLlNpbm9uU2FuZGJveDtcbiAgICBsZXQgc3R1YkZpbGVTeXN0ZW06IElGaWxlU3lzdGVtO1xuICAgIGxldCBmaWxlV3JpdGVUZXh0U3B5OiBTaW5vbi5TaW5vblNweTtcbiAgICBsZXQgb3JpZ2luYWxDb25zb2xlTG9nOiAobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKSA9PiB2b2lkO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIHNhbmRib3ggPSBTaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xuICAgICAgICBzdHViRmlsZVN5c3RlbSA9IDxJRmlsZVN5c3RlbT57fTtcbiAgICAgICAgc3R1YkZpbGVTeXN0ZW0ucGF0aEdldERpcmVjdG9yeSA9IHNhbmRib3guc3R1YigpLnJldHVybnMoXCJ0ZXN0L3VuaXQvdGVtcC9cIik7XG4gICAgICAgIHN0dWJGaWxlU3lzdGVtLnBhdGhHZXRGaWxlbmFtZSA9IHNhbmRib3guc3R1YigpLnJldHVybnMoXCJ0ZXN0LnR4dFwiKTtcbiAgICAgICAgc3R1YkZpbGVTeXN0ZW0uZGlyZWN0b3J5RXhpc3RzID0gYXN5bmMgKGRpcmVjdG9yeU5hbWUpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIHN0dWJGaWxlU3lzdGVtLmRpcmVjdG9yeUNyZWF0ZSA9IGFzeW5jIChkaXJlY3RvcnlOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgc3R1YkZpbGVTeXN0ZW0uZmlsZUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgc3R1YkZpbGVTeXN0ZW0uZmlsZURlbGV0ZSA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIHN0dWJGaWxlU3lzdGVtLmZpbGVXcml0ZVRleHQgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUsIGNvbnRlbnRzLCBhcHBlbmQpID0+IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICAgIGZpbGVXcml0ZVRleHRTcHkgPSBTaW5vbi5zcHkoc3R1YkZpbGVTeXN0ZW0sIFwiZmlsZVdyaXRlVGV4dFwiKTtcblxuICAgICAgICBvcmlnaW5hbENvbnNvbGVMb2cgPSBjb25zb2xlLmxvZztcbiAgICAgICAgY29uc29sZS5sb2cgPSAobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlLmluZGV4T2YoXCJAQEBcIikgPCAwICYmICFtZXNzYWdlLnN0YXJ0c1dpdGgoXCJFUlJPUjogXCIpKSB7XG4gICAgICAgICAgICAgICAgb3JpZ2luYWxDb25zb2xlTG9nKG1lc3NhZ2UsIC4uLm9wdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyA9IG9yaWdpbmFsQ29uc29sZUxvZztcbiAgICB9KTtcblxuICAgIGl0KFwiY2FuIGJlIGNyZWF0ZWRcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgQ2hhaS5zaG91bGQoKS5leGlzdChvYmopO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJpbml0aWFsaXNlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggZXhpc3RpbmcgZGlyZWN0b3J5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHN0dWJGaWxlU3lzdGVtLmRpcmVjdG9yeUV4aXN0cyA9IGFzeW5jIChkaXJlY3RvcnlOYW1lKSA9PiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlDcmVhdGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoc3R1YkZpbGVTeXN0ZW0sIFwiZGlyZWN0b3J5Q3JlYXRlXCIpO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICByZXR1cm4gb2JqLmluaXRpYWxpc2UoKVxuICAgICAgICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZGlyZWN0b3J5Q3JlYXRlU3B5LmNhbGxlZCkudG8uZXF1YWwoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBubyBleGlzdGluZyBkaXJlY3RvcnlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGlyZWN0b3J5Q3JlYXRlU3B5OiBTaW5vbi5TaW5vblNweSA9IHNhbmRib3guc3B5KHN0dWJGaWxlU3lzdGVtLCBcImRpcmVjdG9yeUNyZWF0ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuZXhwZWN0KGRpcmVjdG9yeUNyZWF0ZVNweS5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBleGlzdGluZyBmaWxlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHN0dWJGaWxlU3lzdGVtLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVEZWxldGVTcHk6IFNpbm9uLlNpbm9uU3B5ID0gc2FuZGJveC5zcHkoc3R1YkZpbGVTeXN0ZW0sIFwiZmlsZURlbGV0ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgcmV0dXJuIG9iai5pbml0aWFsaXNlKClcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVEZWxldGVTcHkuY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiY2FuIHRocm93IGFuIGVycm9yXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHN0dWJGaWxlU3lzdGVtLmZpbGVFeGlzdHMgPSBhc3luYyAoZGlyZWN0b3J5TmFtZSwgZmlsZU5hbWUpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcImthYm9vbVwiKSk7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouaW5pdGlhbGlzZSgpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGFzeW5jIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQ2hhaS5leHBlY3QoZXJyKS5ub3QudG8uZXF1YWwodW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImNsb3NlZG93blwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCBldmVuIHdpdGhvdXQgaW5pdGlhbGlzZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouY2xvc2Vkb3duKClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIENoYWkuc2hvdWxkKCkuZXhpc3Qob2JqKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImJhbm5lclwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG51bGwgbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIobnVsbCk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKG9zLkVPTCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIHVuZGVmaW5lZCBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgb2JqLmJhbm5lcih1bmRlZmluZWQpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChvcy5FT0wpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBlbXB0eSBtZXNzYWdlIGFuZCBubyBhcmdzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgb2JqLmJhbm5lcihcIlwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwob3MuRU9MKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIG9iai5iYW5uZXIoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgPT09ICBtZXNzYWdlJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICBvYmouYmFubmVyKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGA9PT0gIG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiaW5mb1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICBvYmouaW5mbyhcIm1lc3NhZ2VcIik7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBJTkZPOiBtZXNzYWdlJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiY2FuIGJlIGNhbGxlZCB3aXRoIG1lc3NhZ2UgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICBvYmouaW5mbyhcIm1lc3NhZ2VcIiwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgSU5GTzogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFwiZm9vXCIke29zLkVPTH1cXHRcXHRhcmcyOiBcImJhclwiJHtvcy5FT0x9YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ3YXJuaW5nXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgbm8gYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIG9iai53YXJuaW5nKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGZpbGVXcml0ZVRleHRTcHkuYXJnc1swXVsyXSkudG8uZXF1YWwoYFdBUk5JTkc6IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIG9iai53YXJuaW5nKFwibWVzc2FnZVwiLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBXQVJOSU5HOiBtZXNzYWdlJHtvcy5FT0x9XFx0XFx0YXJnMTogXCJmb29cIiR7b3MuRU9MfVxcdFxcdGFyZzI6IFwiYmFyXCIke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImVycm9yXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgbm8gZXJyb3IgYW5kIG5vIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIpO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2FsbGVkIHdpdGggbWVzc2FnZSwgbm8gZXJyb3IgYW5kIGFyZ3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IEZpbGVMb2dnZXIoXCJ0ZXN0L3VuaXQvdGVtcC90ZXN0LnR4dFwiLCBzdHViRmlsZVN5c3RlbSk7XG4gICAgICAgICAgICBvYmouZXJyb3IoXCJtZXNzYWdlXCIsIHVuZGVmaW5lZCwgeyBhcmcxOiBcImZvb1wiLCBhcmcyOiBcImJhclwiIH0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYWxsZWQgd2l0aCBtZXNzYWdlLCBlcnJvciBhbmQgYXJnc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgRmlsZUxvZ2dlcihcInRlc3QvdW5pdC90ZW1wL3Rlc3QudHh0XCIsIHN0dWJGaWxlU3lzdGVtKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgbmV3IEVycm9yKFwiQEBAa2Fib29tXCIpLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBhd2FpdCBvYmouY2xvc2Vkb3duKCk7XG4gICAgICAgICAgICBDaGFpLmV4cGVjdChmaWxlV3JpdGVUZXh0U3B5LmFyZ3NbMF1bMl0pLnRvLmVxdWFsKGBFUlJPUjogbWVzc2FnZSR7b3MuRU9MfVxcdFxcdGFyZzE6IFxcXCJmb29cXFwiJHtvcy5FT0x9XFx0XFx0YXJnMjogXFxcImJhclxcXCIke29zLkVPTH1FWENFUFRJT046IEBAQGthYm9vbSR7b3MuRU9MfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZmx1c2hEYXRhXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJjYW4gY2FsbCBvbiB0aW1lclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZXRJbnRlcnZhbFN0dWIgPSBTaW5vbi5zdHViKGdsb2JhbCwgXCJzZXRJbnRlcnZhbFwiKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmluaXRpYWxpc2UoKTtcbiAgICAgICAgICAgIG9iai5lcnJvcihcIm1lc3NhZ2VcIiwgdW5kZWZpbmVkLCB7IGFyZzE6IFwiZm9vXCIsIGFyZzI6IFwiYmFyXCIgfSk7XG4gICAgICAgICAgICBjb25zdCBmbHVzaERhdGEgPSBzZXRJbnRlcnZhbFN0dWIuYXJnc1swXVswXTtcbiAgICAgICAgICAgIGZsdXNoRGF0YSgpO1xuICAgICAgICAgICAgQ2hhaS5leHBlY3QoZmlsZVdyaXRlVGV4dFNweS5hcmdzWzBdWzJdKS50by5lcXVhbChgRVJST1I6IG1lc3NhZ2Uke29zLkVPTH1cXHRcXHRhcmcxOiBcImZvb1wiJHtvcy5FT0x9XFx0XFx0YXJnMjogXCJiYXJcIiR7b3MuRU9MfWApO1xuICAgICAgICAgICAgYXdhaXQgb2JqLmNsb3NlZG93bigpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiB0aHJvdyBhbiBlcnJvclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb25zb2xlTG9nU3B5OiBTaW5vbi5TaW5vblNweSA9IHNhbmRib3guc3B5KGNvbnNvbGUsIFwibG9nXCIpO1xuICAgICAgICAgICAgc3R1YkZpbGVTeXN0ZW0uZmlsZVdyaXRlVGV4dCA9IGFzeW5jIChkaXJlY3RvcnlOYW1lLCBmaWxlTmFtZSwgY29udGVudHMsIGFwcGVuZCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwia2Fib29tXCIpKTtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IG5ldyBGaWxlTG9nZ2VyKFwidGVzdC91bml0L3RlbXAvdGVzdC50eHRcIiwgc3R1YkZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgb2JqLmVycm9yKFwibWVzc2FnZVwiKTtcbiAgICAgICAgICAgIGF3YWl0IG9iai5jbG9zZWRvd24oKTtcbiAgICAgICAgICAgIENoYWkuZXhwZWN0KGNvbnNvbGVMb2dTcHkuYXJnc1swXVswXSkudG8uZXF1YWwoXCJFUlJPUjogTG9nZ2luZyBUbyBGaWxlICd0ZXN0LnR4dCc6IGthYm9vbVwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdfQ==
